<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="alternate" href="/atom.xml" title="退思园" type="application/atom+xml">
  <meta name="google-site-verification" content="EDvvZZUFkxy_QUzZTaqwsG_9VHqFthY-NhQE4j6WL-s">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: 'LHD9LWONQ3',
      apiKey: '23a113c49e36d8cc93f61239cb530b43',
      indexName: 'gowa.club',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="每个进程都有自己的虚拟内存地址空间， Windows 提供了一些API函数来让我们可以从进程外部修改进程的内存，启动线程等。这样我们就可以通过一些非常规的手段让进程执行一些我们自己的代码了。其基本的工作原理是 利用 CreateRemoteThread 在目标进程中建立一个线程，然后调用进程中已经存在的 LoadLibrary() 函数来加载我们指定的 DLL。">
<meta name="keywords" content="Windows,逆向">
<meta property="og:type" content="article">
<meta property="og:title" content="使用远程线程进行DLL的注入">
<meta property="og:url" content="https:&#x2F;&#x2F;gowa.club&#x2F;Windows&#x2F;%E4%BD%BF%E7%94%A8%E8%BF%9C%E7%A8%8B%E7%BA%BF%E7%A8%8B%E8%BF%9B%E8%A1%8CDLL%E7%9A%84%E6%B3%A8%E5%85%A5.html">
<meta property="og:site_name" content="退思园">
<meta property="og:description" content="每个进程都有自己的虚拟内存地址空间， Windows 提供了一些API函数来让我们可以从进程外部修改进程的内存，启动线程等。这样我们就可以通过一些非常规的手段让进程执行一些我们自己的代码了。其基本的工作原理是 利用 CreateRemoteThread 在目标进程中建立一个线程，然后调用进程中已经存在的 LoadLibrary() 函数来加载我们指定的 DLL。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-09-16T12:14:49.000Z">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://gowa.club/Windows/%E4%BD%BF%E7%94%A8%E8%BF%9C%E7%A8%8B%E7%BA%BF%E7%A8%8B%E8%BF%9B%E8%A1%8CDLL%E7%9A%84%E6%B3%A8%E5%85%A5.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>使用远程线程进行DLL的注入 | 退思园</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-137245514-1"></script>
    <script>
      var host = window.location.hostname;
      if (host !== "localhost" || !true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-137245514-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">退思园</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">烦恼一般都是想太多了。</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-soft">

    <a href="/soft/" rel="section"><i class="fa fa-fw fa-rocket"></i>soft</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input" id="search-input"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

  
</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://gowa.club/Windows/%E4%BD%BF%E7%94%A8%E8%BF%9C%E7%A8%8B%E7%BA%BF%E7%A8%8B%E8%BF%9B%E8%A1%8CDLL%E7%9A%84%E6%B3%A8%E5%85%A5.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Gowa2017 Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="退思园">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          使用远程线程进行DLL的注入
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-09-16 20:14:49" itemprop="dateCreated datePublished" datetime="2019-09-16T20:14:49+08:00">2019-09-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Windows/" itemprop="url" rel="index">
                    <span itemprop="name">Windows</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/Windows/%E4%BD%BF%E7%94%A8%E8%BF%9C%E7%A8%8B%E7%BA%BF%E7%A8%8B%E8%BF%9B%E8%A1%8CDLL%E7%9A%84%E6%B3%A8%E5%85%A5.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="Windows/使用远程线程进行DLL的注入.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>每个进程都有自己的虚拟内存地址空间， Windows 提供了一些API函数来让我们可以从进程外部修改进程的内存，启动线程等。这样我们就可以通过一些非常规的手段让进程执行一些我们自己的代码了。其基本的工作原理是 利用 <code>CreateRemoteThread</code> 在目标进程中建立一个线程，然后调用进程中已经存在的 <code>LoadLibrary()</code> 函数来加载我们指定的 DLL。</p>
<a id="more"></a>

<h1 id="CreateRemoteThread"><a href="#CreateRemoteThread" class="headerlink" title="CreateRemoteThread()"></a>CreateRemoteThread()</h1><p>这个函数与 CreateThread 很像，只是多了一个参数而已。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">HANDLE <span class="title">CreateRemoteThread</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">   HANDLE hProcess,</span></span></span><br><span class="line"><span class="function"><span class="params">   PSECURITY_ATTRIBUTES psa,</span></span></span><br><span class="line"><span class="function"><span class="params">   DWORD dwStackSize,</span></span></span><br><span class="line"><span class="function"><span class="params">   PTHREAD_START_ROUTINE pfnStartAddr,</span></span></span><br><span class="line"><span class="function"><span class="params">   PVOID pvParam,</span></span></span><br><span class="line"><span class="function"><span class="params">   DWORD fdwCreate,</span></span></span><br><span class="line"><span class="function"><span class="params">   PDWORD pdwThreadId)</span></span>;”</span><br></pre></td></tr></table></figure>

<p>hProcess 表明了我们想要在其中建立线程的进程句柄，想要获得一个进程的句柄，我们可以用 <code>OpenProcess()</code> 函数来获得。</p>
<h1 id="LoadLibrary"><a href="#LoadLibrary" class="headerlink" title="LoadLibrary()"></a>LoadLibrary()</h1><p>这个方法会加载指定路径的 DLL 文件。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">HINSTANCE <span class="title">LoadLibrary</span><span class="params">(PCTSTR pszLibFile)</span></span>;</span><br></pre></td></tr></table></figure>

<p>其实这个函数根据我们的字符集会调用不同的函数：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">HINSTANCE WINAPI <span class="title">LoadLibraryA</span><span class="params">(LPCSTR  pszLibFileName)</span></span>;</span><br><span class="line"><span class="function">HINSTANCE WINAPI <span class="title">LoadLibraryW</span><span class="params">(LPCWSTR pszLibFileName)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> UNICODE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LoadLibrary  LoadLibraryW</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LoadLibrary  LoadLibraryA</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span>  <span class="comment">// !UNICODE”</span></span></span><br></pre></td></tr></table></figure>

<p>同时其原型与线程的启动函数非常的相似：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">DWORD WINAPI <span class="title">ThreadFunc</span><span class="params">(PVOID pvParam)</span></span>;</span><br></pre></td></tr></table></figure>



<p>看起来我们只需要这样就可以启动一个线程来加载我们自己的DLL了：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">HANDLE hThread = CreateRemoteThread(hProcessRemote, <span class="literal">NULL</span>, <span class="number">0</span>,</span><br><span class="line">   LoadLibraryA, <span class="string">"C:\\MyLib.dll"</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">HANDLE hThread = CreateRemoteThread(hProcessRemote, <span class="literal">NULL</span>, <span class="number">0</span>,</span><br><span class="line">   LoadLibraryW, <span class="string">"C:\\MyLib.dll"</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure>

<p>这样我们建立的新线程就会立马的调用 <code>LoadLibrary{A|W}()</code> 函数了。</p>
<h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>但实际上我们是不能如同上面这样做，因为存在两个问题。</p>
<p>第一个问题是，对于我们想调用的 <code>LoadLibrary{A|W}()</code> 函数，编译后是不可以直接用此名字调用的，这样会出现莫名其妙的问题，我们只能通过查找到这个函数名称所在的内存地址进行调用。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">“<span class="comment">// Get the real address of LoadLibraryA in Kernel32.dll.</span></span><br><span class="line">PTHREAD_START_ROUTINE pfnThreadRtn = (PTHREAD_START_ROUTINE)</span><br><span class="line">   GetProcAddress(GetModuleHandle(TEXT(<span class="string">"Kernel32"</span>)), <span class="string">"LoadLibraryA"</span>);</span><br><span class="line"></span><br><span class="line">HANDLE hThread = CreateRemoteThread(hProcessRemote, <span class="literal">NULL</span>, <span class="number">0</span>,</span><br><span class="line">   pfnThreadRtn, <span class="string">"C:\\MyLib.dll"</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure>

<p>第二个问题是，对于我们需要传递给 <code>LoadLibrary{A|W}()</code> 函数的参数，我们想要加载的 DLL 路径 是位于我们调用进程的地址空间内。这也会出现问题，所以我们还需要将 DLL 路径名先写到目标进程内才行。 这里我们就要用到几个函数了</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 请求向目标进程分配内存</span></span><br><span class="line"><span class="function">PVOID <span class="title">VirtualAllocEx</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">   HANDLE hProcess,</span></span></span><br><span class="line"><span class="function"><span class="params">   PVOID pvAddress,</span></span></span><br><span class="line"><span class="function"><span class="params">   SIZE_T dwSize,</span></span></span><br><span class="line"><span class="function"><span class="params">   DWORD flAllocationType,</span></span></span><br><span class="line"><span class="function"><span class="params">   DWORD flProtect)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求目标进程释放内存</span></span><br><span class="line"><span class="function">BOOL <span class="title">VirtualFreeEx</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">   HANDLE hProcess,</span></span></span><br><span class="line"><span class="function"><span class="params">   PVOID pvAddress,</span></span></span><br><span class="line"><span class="function"><span class="params">   SIZE_T dwSize,</span></span></span><br><span class="line"><span class="function"><span class="params">   DWORD dwFreeType)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读目标进程内存</span></span><br><span class="line"><span class="function">BOOL <span class="title">ReadProcessMemory</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">   HANDLE hProcess,</span></span></span><br><span class="line"><span class="function"><span class="params">   PVOID pvAddressRemote,</span></span></span><br><span class="line"><span class="function"><span class="params">   PVOID pvBufferLocal,</span></span></span><br><span class="line"><span class="function"><span class="params">   DWORD dwSize,</span></span></span><br><span class="line"><span class="function"><span class="params">   PDWORD pdwNumBytesRead)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写目标进程内存</span></span><br><span class="line"><span class="function">BOOL <span class="title">WriteProcessMemory</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">   HANDLE hProcess,</span></span></span><br><span class="line"><span class="function"><span class="params">   PVOID pvAddressRemote,</span></span></span><br><span class="line"><span class="function"><span class="params">   PVOID pvBufferLocal,</span></span></span><br><span class="line"><span class="function"><span class="params">   DWORD dwSize,</span></span></span><br><span class="line"><span class="function"><span class="params">   PDWORD pdwNumBytesWritten)</span></span>;</span><br></pre></td></tr></table></figure>



<h1 id="总结注入过程"><a href="#总结注入过程" class="headerlink" title="总结注入过程"></a>总结注入过程</h1><ol>
<li><code>VirtualAllocEx()</code> 分配一块内存，我们会用来存储我们的 DLL 路径。</li>
<li><code>WriteProcessMemory()</code> 将我们的 DLL 路径写上 第 1 步申请的内存中。</li>
<li><code>GetProcAddress()</code> 函数来获取我们的 <code>LoadLibrary{A|W}()</code> 函数地址。</li>
<li><code>CreateRemoteThread()</code> 来创建远程线程，执行我们找到的 <code>LoadLibrary{A|W}()</code> 函数地址，同时传递 第 1 步中申请的内存作为参数（现在其已经存储了我们的 DLL 路径了）。</li>
<li><code>VirtualFreeEx()</code> 用来释放我们申请存储 DLL 路径的内存。</li>
<li>调用 <code>GetProcAddress()</code> 来获取 <code>FreeLibrary()</code> 函数的地址。</li>
<li>调用 <code>CreateRemoteThread()</code> 建立线程执行 <code>FreeLibrary()</code> 来释放我们 DLL 的 HINSTANCE。</li>
</ol>
<p>这几个步骤中我们需要获得的进程句柄可以用 <code>OpenProcess()</code> 来获得：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">hProcess = OpenProcess(</span><br><span class="line">   PROCESS_CREATE_THREAD |  <span class="comment">// For CreateRemoteThread</span></span><br><span class="line">   PROCESS_VM_OPERATION  |  <span class="comment">// For VirtualAllocEx/VirtualFreeEx</span></span><br><span class="line">   PROCESS_VM_WRITE,        <span class="comment">// For WriteProcessMemory</span></span><br><span class="line">   FALSE, dwProcessId);</span><br></pre></td></tr></table></figure>

<p>具体的例子可以查看 Windows Via C/C++ 的第 22.4.1 节。</p>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/****************************************************************************** Module: InjLib.cpp</span></span><br><span class="line"><span class="comment">Notices: Copyright (c) 2008 Jeffrey Richter &amp; Christophe Nasarre ******************************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"..\CommonFiles\CmnHdr.h"</span> <span class="comment">/* See Appendix A. */</span> </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windowsx.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line">   </span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tchar.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt; // For alloca #include &lt;TlHelp32.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Resource.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;StrSafe.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> UNICODE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> InjectLib InjectLibW #<span class="meta-keyword">define</span> EjectLib EjectLibW</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> InjectLib InjectLibA #<span class="meta-keyword">define</span> EjectLib EjectLibA</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// !UNICODE</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">BOOL WINAPI <span class="title">InjectLibW</span><span class="params">(DWORD dwProcessId, PCWSTR pszLibFile)</span> </span>&#123; </span><br><span class="line">    BOOL bOk = FALSE; <span class="comment">// Assume that the function fails</span></span><br><span class="line">    HANDLE hProcess = <span class="literal">NULL</span>, hThread = <span class="literal">NULL</span>;</span><br><span class="line">    PWSTR pszLibFileRemote = <span class="literal">NULL</span>;</span><br><span class="line">    __try &#123;</span><br><span class="line">        <span class="comment">// Get a handle for the target process.</span></span><br><span class="line">        hProcess = OpenProcess(</span><br><span class="line">            PROCESS_QUERY_INFOMATION |  <span class="comment">// require by Alpha</span></span><br><span class="line">            PROCESS_CREATE_THREAD    |  <span class="comment">// For CreateRemoteThread</span></span><br><span class="line">            PROCESS_VM_OPERATION     |  <span class="comment">// For VirtualAllocEx/VirtualFreeEx</span></span><br><span class="line">            PROCESS_VM_WRITE,            <span class="comment">// For WriteProcessMemory</span></span><br><span class="line">            FALSE, dwProcessId);</span><br><span class="line">        <span class="keyword">if</span> (hProcess == <span class="literal">NULL</span>) __leave;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Calculate the number of bytes needed for the DLL's pathname </span></span><br><span class="line">        <span class="keyword">int</span> cch = <span class="number">1</span> + lstrlenW(pszLibFile); <span class="comment">// numbers of wchars;</span></span><br><span class="line">        <span class="keyword">int</span> cb = cch * <span class="keyword">sizeof</span>(<span class="keyword">wchar_t</span>); <span class="comment">// so, wchar is not one byte per char.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Allocate space in the remote process for the pathname </span></span><br><span class="line">        pszLibFileRemote = (PWSTR)</span><br><span class="line">            VirtualAllocEx(hProcess, <span class="literal">NULL</span>, cb, MEM_COMMIT, PAGE_READWRITE); </span><br><span class="line">        <span class="keyword">if</span> (pszLibFileRemote == <span class="literal">NULL</span>) __leave;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Copy the DLL's pathname to the remote process' address space </span></span><br><span class="line">        <span class="keyword">if</span> (!WriteProcessMemory(hProcess, pszLibFileRemote,</span><br><span class="line">        (PVOID) pszLibFile, cb, <span class="literal">NULL</span>)) __leave;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the real address of LoadLibraryW in Kernel32.dll </span></span><br><span class="line">        PTHREAD_START_ROUTINE pfnThreadRtn = (PTHREAD_START_ROUTINE)</span><br><span class="line">        GetProcAddress(GetModuleHandle(TEXT(<span class="string">"Kernel32"</span>)), <span class="string">"LoadLibraryW"</span>); </span><br><span class="line">        <span class="keyword">if</span> (pfnThreadRtn == <span class="literal">NULL</span>) __leave;</span><br><span class="line">         </span><br><span class="line">        <span class="comment">// Create a remote thread that calls LoadLibraryW(DLLPathname) </span></span><br><span class="line">        hThread = CreateRemoteThread(hProcess, <span class="literal">NULL</span>, <span class="number">0</span>,</span><br><span class="line">            pfnThreadRtn, pszLibFileRemote, <span class="number">0</span>, <span class="literal">NULL</span>); </span><br><span class="line">        <span class="keyword">if</span> (hThread == <span class="literal">NULL</span>) __leave;</span><br><span class="line">    <span class="comment">// Wait for the remote thread to terminate </span></span><br><span class="line">        WaitForSingleObject(hThread, INFINITE);</span><br><span class="line">        bOk = TRUE; <span class="comment">// Everything executed successfully &#125;</span></span><br><span class="line">    __finally &#123; <span class="comment">// Now, we can clean everything up</span></span><br><span class="line">    <span class="comment">// Free the remote memory that contained the DLL's pathname </span></span><br><span class="line">        <span class="keyword">if</span> (pszLibFileRemote != <span class="literal">NULL</span>)</span><br><span class="line">            VirtualFreeEx(hProcess, pszLibFileRemote, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line">            <span class="keyword">if</span> (hThread != <span class="literal">NULL</span>) </span><br><span class="line">                CloseHandle(hThread);</span><br><span class="line">            <span class="keyword">if</span> (hProcess != <span class="literal">NULL</span>) </span><br><span class="line">                CloseHandle(hProcess);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span>(bOk);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">BOOL WINAPI <span class="title">InjectLibA</span><span class="params">(DWORD dwProcessId, PCSTR pszLibFile)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Allocate a (stack) buffer for the Unicode version of the pathname </span></span><br><span class="line">        SIZE_T cchSize = lstrlenA(pszLibFile) + <span class="number">1</span>;</span><br><span class="line">        PWSTR pszLibFileW = (PWSTR)</span><br><span class="line">            _alloca(cchSize * <span class="keyword">sizeof</span>(<span class="keyword">wchar_t</span>));</span><br><span class="line">        <span class="comment">// Convert the ANSI pathname to its Unicode equivalent </span></span><br><span class="line">        StringCchPrintfW(pszLibFileW, cchSize, <span class="string">L"%S"</span>, pszLibFile);</span><br><span class="line">        <span class="comment">// Call the Unicode version of the function to actually do the work. </span></span><br><span class="line">        <span class="keyword">return</span>(InjectLibW(dwProcessId, pszLibFileW));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL WINAPI <span class="title">EjectLibW</span><span class="params">(DWORD dwProcessId, PCWSTR pszLibFile)</span> </span>&#123;</span><br><span class="line">    BOOL bOk = FALSE; <span class="comment">// Assume that the function fails </span></span><br><span class="line">    HANDLE hthSnapshot = <span class="literal">NULL</span>;</span><br><span class="line">    HANDLE hProcess = <span class="literal">NULL</span>, hThread = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    __try &#123;</span><br><span class="line">        <span class="comment">// Grab a new snapshot of the process</span></span><br><span class="line">        hthSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPMODULE, dwProcessId);</span><br><span class="line">        <span class="keyword">if</span> (hthSnapshot == INVALID_HANDLE_VALUE) __leave;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the HMODULE of the desired library MODULEENTRY32W me = &#123; sizeof(me) &#125;;</span></span><br><span class="line">        BOOL bFound = FALSE;</span><br><span class="line">        BOOL bMoreMods = Module32FirstW(hthSnapshot, &amp;me);</span><br><span class="line">        <span class="keyword">for</span> (; bMoreMods; bMoreMods = Module32NextW(hthSnapshot, &amp;me)) &#123;</span><br><span class="line">            bFound = (_wcsicmp(me.szModule, pszLibFile) == <span class="number">0</span>) || (_wcsicmp(me.szExePath, pszLibFile) == <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (bFound) <span class="keyword">break</span>; </span><br><span class="line">         &#125;</span><br><span class="line">        <span class="keyword">if</span> (!bFound) __leave;</span><br><span class="line">        <span class="comment">// Get a handle for the target process. </span></span><br><span class="line">        hProcess = OpenProcess(</span><br><span class="line">        PROCESS_QUERY_INFORMATION | </span><br><span class="line">        PROCESS_CREATE_THREAD | <span class="comment">// For CreateRemoteThread </span></span><br><span class="line">        PROCESS_VM_OPERATION, FALSE, dwProcessId);</span><br><span class="line">        <span class="keyword">if</span> (hProcess == <span class="literal">NULL</span>) __leave;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the real address of FreeLibrary in Kernel32.dll </span></span><br><span class="line">        PTHREAD_START_ROUTINE pfnThreadRtn = (PTHREAD_START_ROUTINE)</span><br><span class="line">        GetProcAddress(GetModuleHandle(TEXT(<span class="string">"Kernel32"</span>)), <span class="string">"FreeLibrary"</span>); </span><br><span class="line">        <span class="keyword">if</span> (pfnThreadRtn == <span class="literal">NULL</span>) __leave;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create a remote thread that calls FreeLibrary() </span></span><br><span class="line">        hThread = CreateRemoteThread(hProcess, <span class="literal">NULL</span>, <span class="number">0</span>,</span><br><span class="line">        pfnThreadRtn, me.modBaseAddr, <span class="number">0</span>, <span class="literal">NULL</span>); </span><br><span class="line">        <span class="keyword">if</span> (hThread == <span class="literal">NULL</span>) __leave;</span><br><span class="line">        <span class="comment">// Wait for the remote thread to terminate </span></span><br><span class="line">        WaitForSingleObject(hThread, INFINITE);</span><br><span class="line">        bOk = TRUE; <span class="comment">// Everything executed successfully &#125;</span></span><br><span class="line">    __finally &#123; <span class="comment">// Now we can clean everything up</span></span><br><span class="line">        <span class="keyword">if</span> (hthSnapshot != <span class="literal">NULL</span>) </span><br><span class="line">            CloseHandle(hthSnapshot);</span><br><span class="line">        <span class="keyword">if</span> (hThread != <span class="literal">NULL</span>) </span><br><span class="line">            CloseHandle(hThread);</span><br><span class="line">        <span class="keyword">if</span> (hProcess != <span class="literal">NULL</span>) </span><br><span class="line">            CloseHandle(hProcess);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">return</span>(bOk);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL WINAPI <span class="title">EjectLibA</span><span class="params">(DWORD dwProcessId, PCSTR pszLibFile)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Allocate a (stack) buffer for the Unicode version of the pathname </span></span><br><span class="line">    SIZE_T cchSize = lstrlenA(pszLibFile) + <span class="number">1</span>;</span><br><span class="line">    PWSTR pszLibFileW = (PWSTR)</span><br><span class="line">    _alloca(cchSize * <span class="keyword">sizeof</span>(<span class="keyword">wchar_t</span>));</span><br><span class="line">    <span class="comment">// Convert the ANSI pathname to its Unicode equivalent </span></span><br><span class="line">    StringCchPrintfW(pszLibFileW, cchSize, <span class="string">L"%S"</span>, pszLibFile);</span><br><span class="line">    <span class="comment">// Call the Unicode version of the function to actually do the work. </span></span><br><span class="line">    <span class="keyword">return</span>(EjectLibW(dwProcessId, pszLibFileW));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">Dlg_OnInitDialog</span><span class="params">(HWND hWnd, HWND hWndFocus, LPARAM lParam)</span> </span>&#123;</span><br><span class="line">    chSETDLGICONS(hWnd, IDI_INJLIB); </span><br><span class="line">    <span class="keyword">return</span>(TRUE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dlg_OnCommand</span><span class="params">(HWND hWnd, <span class="keyword">int</span> id, HWND hWndCtl, UINT codeNotify)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (id) &#123; </span><br><span class="line">        <span class="keyword">case</span> IDCANCEL:</span><br><span class="line">             EndDialog(hWnd, id);</span><br><span class="line">             <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IDC_INJECT:</span><br><span class="line">            DWORD dwProcessId = GetDlgItemInt(hWnd, IDC_PROCESSID, <span class="literal">NULL</span>, FALSE);</span><br><span class="line">            <span class="keyword">if</span> (dwProcessId == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// A process ID of 0 causes everything to take place in the // local process; this makes things easier for debugging. </span></span><br><span class="line">            dwProcessId = GetCurrentProcessId();</span><br><span class="line">            &#125;</span><br><span class="line">            TCHAR szLibFile[MAX_PATH];</span><br><span class="line">            GetModuleFileName(<span class="literal">NULL</span>, szLibFile, _countof(szLibFile));</span><br><span class="line">            PTSTR pFilename = _tcsrchr(szLibFile, TEXT(<span class="string">'\\'</span>)) + <span class="number">1</span>; </span><br><span class="line">            _tcscpy_s(pFilename, _countof(szLibFile) - (szLibFile - szLibFile),</span><br><span class="line">                TEXT(<span class="string">"22-ImgWalk.DLL"</span>));</span><br><span class="line">            <span class="keyword">if</span> (InjectLib(dwProcessId, szLibFile)) &#123;</span><br><span class="line">                chVERIFY(EjectLib(dwProcessId, szLibFile));</span><br><span class="line">                chMB(<span class="string">"DLL Injection/Ejection successful."</span>); </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                chMB(<span class="string">"DLL Injection/Ejection failed."</span>); </span><br><span class="line">            &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">NT_PTR WINAPI <span class="title">Dlg_Proc</span><span class="params">(HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (uMsg) &#123;</span><br><span class="line">        chHANDLE_DLGMSG(hWnd, WM_INITDIALOG, Dlg_OnInitDialog);</span><br><span class="line">        chHANDLE_DLGMSG(hWnd, WM_COMMAND, Dlg_OnCommand); &#125;</span><br><span class="line">   <span class="keyword">return</span>(FALSE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> WINAPI _tWinMain(HINSTANCE hInstExe, HINSTANCE, PTSTR pszCmdLine, <span class="keyword">int</span>) &#123;</span><br><span class="line">    DialogBox(hInstExe, MAKEINTRESOURCE(IDD_INJLIB), <span class="literal">NULL</span>, Dlg_Proc); </span><br><span class="line">    <span class="keyword">return</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/****************************************************************************** Module: ImgWalk.cpp</span></span><br><span class="line"><span class="comment">Notices: Copyright (c) 2008 Jeffrey Richter &amp; Christophe Nasarre </span></span><br><span class="line"><span class="comment">******************************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"..\CommonFiles\CmnHdr.h"</span> <span class="comment">/* See Appendix A. */</span> </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tchar.h&gt;</span></span></span><br><span class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////////// </span></span><br><span class="line"><span class="function">BOOL WINAPI <span class="title">DllMain</span><span class="params">(HINSTANCE hInstDll, DWORD fdwReason, PVOID fImpLoad)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (fdwReason == DLL_PROCESS_ATTACH) &#123; </span><br><span class="line">        <span class="keyword">char</span> szBuf[MAX_PATH * <span class="number">100</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">        PBYTE pb = <span class="literal">NULL</span>;</span><br><span class="line">        MEMORY_BASIC_INFORMATION mbi;</span><br><span class="line">        <span class="keyword">while</span> (VirtualQuery(pb, &amp;mbi, <span class="keyword">sizeof</span>(mbi)) == <span class="keyword">sizeof</span>(mbi)) &#123;</span><br><span class="line">                 <span class="keyword">int</span> nLen;</span><br><span class="line">                 <span class="keyword">char</span> szModName[MAX_PATH];</span><br><span class="line">                <span class="keyword">if</span> (mbi.State == MEM_FREE) </span><br><span class="line">                    mbi.AllocationBase = mbi.BaseAddress;</span><br><span class="line">                <span class="keyword">if</span> ((mbi.AllocationBase == hInstDll) || </span><br><span class="line">                    (mbi.AllocationBase != mbi.BaseAddress) ||</span><br><span class="line">                    (mbi.AllocationBase == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">                    <span class="comment">// Do not add the module name to the list</span></span><br><span class="line">                    <span class="comment">// if any of the following is true:</span></span><br><span class="line">                    <span class="comment">// 1. If this region contains this DLL</span></span><br><span class="line">                    <span class="comment">// 2. If this block is NOT the beginning of a region // 3. If the address is NULL</span></span><br><span class="line">                    nLen = <span class="number">0</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    nLen = GetModuleFileNameA((HINSTANCE) mbi.AllocationBase,</span><br><span class="line">                                  szModName, _countof(szModName));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (nLen &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    wsprintfA(<span class="built_in">strchr</span>(szBuf, <span class="number">0</span>), <span class="string">"\n%p-%s"</span>,</span><br><span class="line">                              mbi.AllocationBase, szModName);</span><br><span class="line">                &#125;</span><br><span class="line">                pb += mbi.RegionSize; </span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> Normally, you should not display a message box in DllMain // due to the loader lock described in Chapter 20. However, to keep</span></span><br><span class="line">       </span><br><span class="line">     </span><br><span class="line">    <span class="comment">// this sample application simple, I am violating this rule.</span></span><br><span class="line">           chMB(&amp;szBuf[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>(TRUE);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Windows/" rel="tag"># Windows</a>
              <a href="/tags/%E9%80%86%E5%90%91/" rel="tag"># 逆向</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/Git/Git%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AD%98%E5%82%A8%E8%A3%B8%E5%BA%93%E5%8F%8A%E5%A4%9A%E4%B8%AA%E5%B7%A5%E4%BD%9C%E5%8C%BA.html" rel="next" title="Git服务器存储裸库及多个工作区">
                  <i class="fa fa-chevron-left"></i> Git服务器存储裸库及多个工作区
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/Asm/X86%E6%B1%87%E7%BC%96%E6%93%8D%E4%BD%9C%E6%95%B0%E5%AF%BB%E5%9D%80.html" rel="prev" title="X86汇编操作数寻址">
                  X86汇编操作数寻址 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
  <div class="comments" id="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#CreateRemoteThread"><span class="nav-number">1.</span> <span class="nav-text">CreateRemoteThread()</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#LoadLibrary"><span class="nav-number">2.</span> <span class="nav-text">LoadLibrary()</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#问题"><span class="nav-number">3.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#总结注入过程"><span class="nav-number">4.</span> <span class="nav-text">总结注入过程</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Code"><span class="nav-number">5.</span> <span class="nav-text">Code</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Gowa2017 Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">302</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">123</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/gowa2017" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;gowa2017" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/mailto:shouzheng.zhang@gmail.com" title="E-Mail → mailto:shouzheng.zhang@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-json"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Gowa2017 Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.5.0
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css">
<script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.js"></script><script src="/js/algolia-search.js"></script>














  

  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://gowa-1.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  function loadComments() {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "https://gowa.club/Windows/%E4%BD%BF%E7%94%A8%E8%BF%9C%E7%A8%8B%E7%BA%BF%E7%A8%8B%E8%BF%9B%E8%A1%8CDLL%E7%9A%84%E6%B3%A8%E5%85%A5.html",
            identifier: "Windows/使用远程线程进行DLL的注入.html",
            title: "使用远程线程进行DLL的注入"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://gowa-1.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  }
    window.addEventListener('load', loadComments, false);
</script>

</body>
</html>
