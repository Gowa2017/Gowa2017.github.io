<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Skynet的启动与服务载入流程 | 退思园</title><link rel="stylesheet" type="text/css" href="//fonts.neworld.org/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Skynet的启动与服务载入流程</h1><a id="logo" href="/.">退思园</a><p class="description">烦恼一般都是想太多了。</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Skynet的启动与服务载入流程</h1><div class="post-meta"><a href="/Lua/skynet的启动与服务载入流程.html#comments" class="comment-count"></a><p><span class="date">Feb 01, 2018</span><span><a href="/categories/Lua/" class="category">Lua</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>一直以来很喜欢玩游戏，却一直没有自己开发过游戏，主要是不知道怎么入手。以前接触过的一款游戏就是以C++写程序，然后Lua做脚本和逻辑的。偶然间发现了skynet这个框架，作者居然是多年以前我就已经仰视已久的人物。用这个，加上客户端用cocos2dx的话，似乎确实能做出我自己想做的一些小游戏了。<br><a id="more"></a></p>
<h1 id="项目"><a href="#项目" class="headerlink" title="项目"></a>项目</h1><p>这个项目在<a href="https://github.com/cloudwu/skynet" target="_blank" rel="noopener">github.com开源</a>。是一个用于在线游戏服务器的框架，但是不仅仅用于游戏，很多其他服务端也能用到。其是基与c和lua的。其内部封装了<strong>mysql, mongodb, socket</strong>等库，用起来确实是很不错的。但是性能方面暂时不知道，但是看云风大大一直追求的性能和效率的话应该不会差。</p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Skynet 的单机模型来说，只有一个进程。然后把用 Lua 编写的每个业务逻辑单元叫做<em>服务</em>。所有的数据，消息的传递只在进程内部，因此的话，效率是有保证的，唯一可能出现考量的地方，就是Lua的虚拟机是否依然高效。这比传统的多进程间的通信模型就简单了许多，不需要用到什么共享内存，消息队列等了。</p>
<p>对于想启动一个服务，只需要调用<code>skynet.newservice(name)</code>，这将会返回一个服务地址，就可以了。<em>name</em>是脚本名。Skynet 会根据我们配置文件中的 <em>luaservice</em> 目录去寻找对应的 <em>name.lua</em> 文件。另外注意，类似 <code>.launcher</code> 这样的服务只是在本机可见， 在节间是不可见的。同时我们可以用<code>skynet.name(name, addr)</code>把一个服务地址给绑定到一个别名，以后凡是用到服务地址的地方都可以使用名字。</p>
<h1 id="服务的三个阶段"><a href="#服务的三个阶段" class="headerlink" title="服务的三个阶段"></a>服务的三个阶段</h1><p>每个Lua都分为三个阶段：</p>
<ul>
<li>加载阶段。加载Lua脚本到内存，分配一个实例。</li>
<li>初始化阶段。由<code>skynet.start(function() ... end)</code>注册的初始化函数进行初始化。我们的<code>skynet.newservice(name)</code>会在这个函数执行完毕后才返回。</li>
<li>工作阶段。<h1 id="启动过程"><a href="#启动过程" class="headerlink" title="启动过程"></a>启动过程</h1>skynet的主程序，通过类似：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">./skynet config.lua</span><br></pre></td></tr></table></figure>
<p>这样的命令行启动。然后主程序就会读入这个配置文件，进行启动各项服务。  </p>
<p>我们先来看一下这个配置文件默认情况下是什么样的。</p>
<h2 id="config-lua"><a href="#config-lua" class="headerlink" title="config.lua"></a>config.lua</h2><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">root = <span class="string">"./"</span></span><br><span class="line">thread = <span class="number">8</span></span><br><span class="line">logger = <span class="literal">nil</span></span><br><span class="line">harbor = <span class="number">1</span></span><br><span class="line">address = <span class="string">"127.0.0.1:2526"</span></span><br><span class="line">master = <span class="string">"127.0.0.1:2013"</span></span><br><span class="line">start = <span class="string">"main"</span>    <span class="comment">-- main script</span></span><br><span class="line">bootstrap = <span class="string">"snlua bootstrap"</span>    <span class="comment">-- The service for bootstrap</span></span><br><span class="line">standalone = <span class="string">"0.0.0.0:2013"</span></span><br><span class="line">luaservice = root..<span class="string">"service/?.lua;"</span>..root..<span class="string">"test/?.lua;"</span>..root..<span class="string">"examples/?.lua"</span></span><br><span class="line">lualoader = <span class="string">"lualib/loader.lua"</span></span><br><span class="line">snax = root..<span class="string">"examples/?.lua;"</span>..root..<span class="string">"test/?.lua"</span></span><br><span class="line"><span class="built_in">cpath</span> = root..<span class="string">"cservice/?.so"</span></span><br></pre></td></tr></table></figure>
<p>单机模型下，我们可以暂时忽略<em>address, master, standalone</em>三个字段。现在把重心放在启动的流程上面，暂时不要管多节点的情况。</p>
<ul>
<li><strong>thread</strong>：线程数，一般设置为和CPU核心数量一致</li>
<li><strong>bootstrap</strong>：启动的第一个服务及参数。<em>snlua bootstrap</em>是默认配置，说明的是以<em>bootstrap</em>参数启动<em>snlua</em>服务（ snlua 是 lua 的沙盒服务，相当于开启一个 Lua 虚拟机了），之后的所有服务都直接或间接的由这个服务启动。默认情况下，<em>bootstrap</em>服务文件位于<code>service/bootstrap.lua</code>下。指定服务文件名不需要带上<code>.lua</code>扩展名。</li>
<li><strong>cpath</strong>： 用 C 编写的服务模块的位置，通常指 cservice 下那些 .so 文件。如果你的系统的动态库不是以 .so 为后缀，需要做相应的修改。这个路径可以配置多项，以 ; 分割。</li>
<li><strong>luaservice</strong>：lua服务文件的位置。也就是说，当我们启动一个服务的时候，去哪里寻找并载入对应的文件。</li>
<li><strong>loader</strong>：用哪一段 lua 代码加载 lua 服务。通常配置为<code>lualib/loader.lua</code> ，再由这段代码解析服务名称，进一步加载 lua 代码。snlua 会将下面几个配置项取出，放在初始化好的 lua 虚拟机的全局变量中。具体可参考实现。<br>SERVICE_NAME 第一个参数，通常是服务名。<br>LUA_PATH config 文件中配置的 lua_path 。<br>LUA_CPATH config 文件中配置的 lua_cpath 。<br>LUA_PRELOAD config 文件中配置的 preload 。<br>LUA_SERVICE config 文件中配置的 luaservice 。  </li>
<li><strong>lua_path</strong>： 将添加到 package.path 中的路径，供 require 调用。</li>
<li><strong>lua_cpath</strong>： 将添加到 package.cpath 中的路径，供 require 调用</li>
</ul>
<h2 id="logger"><a href="#logger" class="headerlink" title="logger"></a>logger</h2><blockquote>
<p>第一个启动的服务是 logger ，它负责记录之后的服务中的 log 输出。logger 是一个简单的 C 服务， skynet_error  这个 C API 会把字符串发送给它。在 config 文件中，logger 配置项可以配置 log 输出的文件名，默认是 nil ，表示输出到标准输出。</p>
</blockquote>
<h2 id="snlua"><a href="#snlua" class="headerlink" title="snlua"></a>snlua</h2><p>snlua是一个C模块的服务，在<code>cservice/snlua.so</code>下，所有的Lua服务其实都是snlua模块服务的实例，只是承载的Lua脚本不同而已。</p>
<h2 id="bootstrap"><a href="#bootstrap" class="headerlink" title="bootstrap"></a>bootstrap</h2><p>Skynet运行的第二个服务是<code>snlua bootstrap</code>，表示启动<strong>snlua</strong>服务，以<code>bootstrap</code>作为参数进行初始化，<strong>snlua</strong>是lua的沙盒服务。同样，服务名<em>bootstrap</em>指定后，会根据<code>luaservice</code>配置的路径来寻找对应的<code>bootstrap.lua</code>文件并加载执行。</p>
<p>在skynet的源码文件<code>skynet-serc/skynet_start.c</code>中，有<code>bootstrap(ctx, config-&gt;bootstrap)</code>调用。</p>
<p>当前<em>bootstrap.lua</em>文件如下：</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> skynet = <span class="built_in">require</span> <span class="string">"skynet"</span></span><br><span class="line"><span class="keyword">local</span> harbor = <span class="built_in">require</span> <span class="string">"skynet.harbor"</span></span><br><span class="line"></span><br><span class="line">skynet.start(<span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> standalone = skynet.<span class="built_in">getenv</span> <span class="string">"standalone"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> launcher = <span class="built_in">assert</span>(skynet.launch(<span class="string">"snlua"</span>,<span class="string">"launcher"</span>))</span><br><span class="line">    skynet.name(<span class="string">".launcher"</span>, launcher)</span><br><span class="line">        <span class="keyword">local</span> harbor_id = <span class="built_in">tonumber</span>(skynet.<span class="built_in">getenv</span> <span class="string">"harbor"</span>)</span><br><span class="line">    <span class="keyword">if</span> harbor_id == <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">assert</span>(standalone ==  <span class="literal">nil</span>)</span><br><span class="line">        standalone = <span class="literal">true</span></span><br><span class="line">        skynet.setenv(<span class="string">"standalone"</span>, <span class="string">"true"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">local</span> ok, slave = <span class="built_in">pcall</span>(skynet.newservice, <span class="string">"cdummy"</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">            skynet.abort()</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        skynet.name(<span class="string">".slave"</span>, slave)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span> standalone <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">pcall</span>(skynet.newservice,<span class="string">"cmaster"</span>) <span class="keyword">then</span></span><br><span class="line">                skynet.abort()</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">local</span> ok, slave = <span class="built_in">pcall</span>(skynet.newservice, <span class="string">"cslave"</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">            skynet.abort()</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        skynet.name(<span class="string">".slave"</span>, slave)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> standalone <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">local</span> datacenter = skynet.newservice <span class="string">"datacenterd"</span></span><br><span class="line">        skynet.name(<span class="string">"DATACENTER"</span>, datacenter)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    skynet.newservice <span class="string">"service_mgr"</span></span><br><span class="line">    <span class="built_in">pcall</span>(skynet.newservice,skynet.<span class="built_in">getenv</span> <span class="string">"start"</span> <span class="keyword">or</span> <span class="string">"main"</span>)</span><br><span class="line">    skynet.<span class="built_in">exit</span>()</span><br><span class="line"><span class="keyword">end</span>)</span><br></pre></td></tr></table></figure>
<p>代码中，首先就执行了:</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> launcher = <span class="built_in">assert</span>(skynet.launch(<span class="string">"snlua"</span>,<span class="string">"launcher"</span>))</span><br><span class="line">skynet.name(<span class="string">".launcher"</span>, launcher)</span><br></pre></td></tr></table></figure>
<p>这个就是首先启动一个 C 服务模块 <code>snlua</code>，然后以 <code>launcher</code>进行初始化。 </p>
<p><code>skynet.launch</code>定义在<code>skynet/manager.lua</code>中：</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> c = <span class="built_in">require</span> <span class="string">"skynet.core"</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">skynet.launch</span><span class="params">(...)</span></span></span><br><span class="line">        <span class="keyword">local</span> addr = c.command(<span class="string">"LAUNCH"</span>, <span class="built_in">table</span>.<span class="built_in">concat</span>(&#123;...&#125;,<span class="string">" "</span>))</span><br><span class="line">        <span class="keyword">if</span> addr <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">tonumber</span>(<span class="string">"0x"</span> .. <span class="built_in">string</span>.<span class="built_in">sub</span>(addr , <span class="number">2</span>))</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>其用处是用来启动一个C模块的服务。</p>
<h2 id="skynet-core"><a href="#skynet-core" class="headerlink" title="skynet.core"></a>skynet.core</h2><p>其返回值是一个地址。这里我们看到，<code>skynet.core</code>是一个被导入的库，真实执行的就是这个库内导出的函数。在文件<code>lualib-src/lua-skynet.c</code>中，我们看到了这个函数的导出：</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">LUAMOD_API int</span><br><span class="line">luaopen_skynet_core(lua_State *L) &#123;</span><br><span class="line">        luaL_checkversion(L);</span><br><span class="line"></span><br><span class="line">        luaL_Reg l[] = &#123;</span><br><span class="line">                &#123; <span class="string">"send"</span> , lsend &#125;,</span><br><span class="line">                &#123; <span class="string">"genid"</span>, lgenid &#125;,</span><br><span class="line">                &#123; <span class="string">"redirect"</span>, lredirect &#125;,</span><br><span class="line">                &#123; <span class="string">"command"</span> , lcommand &#125;,</span><br><span class="line">                &#123; <span class="string">"intcommand"</span>, lintcommand &#125;,</span><br><span class="line">                &#123; <span class="string">"error"</span>, lerror &#125;,</span><br><span class="line">                &#123; <span class="string">"tostring"</span>, ltostring &#125;,</span><br><span class="line">                &#123; <span class="string">"harbor"</span>, lharbor &#125;,</span><br><span class="line">                &#123; <span class="string">"pack"</span>, luaseri_pack &#125;,</span><br><span class="line">                &#123; <span class="string">"unpack"</span>, luaseri_unpack &#125;,</span><br><span class="line">                &#123; <span class="string">"packstring"</span>, lpackstring &#125;,</span><br><span class="line">                &#123; <span class="string">"trash"</span> , ltrash &#125;,</span><br><span class="line">                &#123; <span class="string">"callback"</span>, lcallback &#125;,</span><br><span class="line">                &#123; <span class="string">"now"</span>, lnow &#125;,</span><br><span class="line">                &#123; NULL, NULL &#125;,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        luaL_newlibtable(L, l);</span><br><span class="line"></span><br><span class="line">        lua_getfield(L, LUA_REGISTRYINDEX, <span class="string">"skynet_context"</span>);</span><br><span class="line">        struct skynet_context *ctx = lua_touserdata(L,<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">if</span> (ctx == NULL) &#123;</span><br><span class="line">                <span class="keyword">return</span> luaL_error(L, <span class="string">"Init skynet context first"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        luaL_setfuncs(L,l,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static int</span><br><span class="line">lcommand(lua_State *L) &#123;</span><br><span class="line">        struct skynet_context * context = lua_touserdata(L, lua_upvalueindex(<span class="number">1</span>));</span><br><span class="line">        const <span class="built_in">char</span> * cmd = luaL_checkstring(L,<span class="number">1</span>);</span><br><span class="line">        const <span class="built_in">char</span> * result;</span><br><span class="line">        const <span class="built_in">char</span> * parm = NULL;</span><br><span class="line">        <span class="keyword">if</span> (lua_gettop(L) == <span class="number">2</span>) &#123;</span><br><span class="line">                parm = luaL_checkstring(L,<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        result = skynet_command(context, cmd, parm);</span><br><span class="line">        <span class="keyword">if</span> (result) &#123;</span><br><span class="line">                lua_pushstring(L, result);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>skynet-src/skynet_server.c</code>中，定义了<code>skynet_command</code>函数：</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">static struct command_func cmd_funcs[] = &#123;</span><br><span class="line">        &#123; <span class="string">"TIMEOUT"</span>, cmd_timeout &#125;,</span><br><span class="line">        &#123; <span class="string">"REG"</span>, cmd_reg &#125;,</span><br><span class="line">        &#123; <span class="string">"QUERY"</span>, cmd_query &#125;,</span><br><span class="line">        &#123; <span class="string">"NAME"</span>, cmd_name &#125;,</span><br><span class="line">        &#123; <span class="string">"EXIT"</span>, cmd_exit &#125;,</span><br><span class="line">        &#123; <span class="string">"KILL"</span>, cmd_kill &#125;,</span><br><span class="line">        &#123; <span class="string">"LAUNCH"</span>, cmd_launch &#125;,</span><br><span class="line">        &#123; <span class="string">"GETENV"</span>, cmd_getenv &#125;,</span><br><span class="line">        &#123; <span class="string">"SETENV"</span>, cmd_setenv &#125;,</span><br><span class="line">        &#123; <span class="string">"STARTTIME"</span>, cmd_starttime &#125;,</span><br><span class="line">        &#123; <span class="string">"ABORT"</span>, cmd_abort &#125;,</span><br><span class="line">        &#123; <span class="string">"MONITOR"</span>, cmd_monitor &#125;,</span><br><span class="line">        &#123; <span class="string">"STAT"</span>, cmd_stat &#125;,</span><br><span class="line">        &#123; <span class="string">"LOGON"</span>, cmd_logon &#125;,</span><br><span class="line">        &#123; <span class="string">"LOGOFF"</span>, cmd_logoff &#125;,</span><br><span class="line">        &#123; <span class="string">"SIGNAL"</span>, cmd_signal &#125;,</span><br><span class="line">        &#123; NULL, NULL &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const <span class="built_in">char</span> *</span><br><span class="line">skynet_command(struct skynet_context * context, const <span class="built_in">char</span> * cmd , const <span class="built_in">char</span> * param) &#123;</span><br><span class="line">        struct command_func * method = &amp;cmd_funcs[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">while</span>(method-&gt;name) &#123;</span><br><span class="line">                <span class="keyword">if</span> (strcmp(cmd, method-&gt;name) == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> method-&gt;func(context, param);</span><br><span class="line">                &#125;</span><br><span class="line">                ++method;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> NULL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static const <span class="built_in">char</span> *</span><br><span class="line">cmd_launch(struct skynet_context * context, const <span class="built_in">char</span> * param) &#123;</span><br><span class="line">        size_t sz = strlen(param);</span><br><span class="line">        <span class="built_in">char</span> tmp[sz+<span class="number">1</span>];</span><br><span class="line">        strcpy(tmp,param);</span><br><span class="line">        <span class="built_in">char</span> * args = tmp;</span><br><span class="line">        <span class="built_in">char</span> * <span class="built_in">mod</span> = strsep(&amp;args, <span class="string">" \t\r\n"</span>);</span><br><span class="line">        args = strsep(&amp;args, <span class="string">"\r\n"</span>);</span><br><span class="line">        struct skynet_context * inst = skynet_context_new(<span class="built_in">mod</span>,args);</span><br><span class="line">        <span class="keyword">if</span> (inst == NULL) &#123;</span><br><span class="line">                <span class="keyword">return</span> NULL;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                id_to_hex(context-&gt;result, inst-&gt;handle);</span><br><span class="line">                <span class="keyword">return</span> context-&gt;result;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最终返回的是一个服务地址。<br><code>skynet.name(name, add)</code>则是将一个服务地址绑定为一个别名。</p>
<h1 id="不同"><a href="#不同" class="headerlink" title="不同"></a>不同</h1><p>可以看到，只有第一个服务 <em>launcher</em> 是以<code>skynet.launch</code>启动，而其他服务都是以<code>pcall(skynet.newservice())</code>来启动的。如<em>.cslave, .cmaster, DATACENTER, service_mgr</em>。最后，<code>bootstrap.lua</code>服务会最后启动<code>start=</code>设置的值，默认情况下是<code>main</code>，当然我们可以设置为其他的。</p>
<p>我们看到，<code>skynet.launch</code>最终是调用的C代码进行了启动服务。而对于 <code>skynet.newservice</code>，其在<code>lualib/skynet.lua</code>中进行了定义：</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- lualib/skynet.lua</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">skynet.newservice</span><span class="params">(name, ...)</span></span></span><br><span class="line">        <span class="keyword">return</span> skynet.call(<span class="string">".launcher"</span>, <span class="string">"lua"</span> , <span class="string">"LAUNCH"</span>, <span class="string">"snlua"</span>, name, ...)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">skynet.call</span><span class="params">(addr, typename, ...)</span></span></span><br><span class="line">        <span class="keyword">local</span> p = proto[typename]</span><br><span class="line">        <span class="keyword">local</span> session = c.send(addr, p.id , <span class="literal">nil</span> , p.pack(...))</span><br><span class="line">        <span class="keyword">if</span> session == <span class="literal">nil</span> <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">error</span>(<span class="string">"call to invalid address "</span> .. skynet.address(addr))</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">return</span> p.<span class="built_in">unpack</span>(yield_call(addr, session))</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>是通过向 <strong>.launcher</strong>发送消息来启动服务的。也即是说，.launcher 就是服务的启动器了。</p>
<h1 id="skynet-call"><a href="#skynet-call" class="headerlink" title="skynet.call"></a>skynet.call</h1><p>此Lua函数原型是:</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">skynet.call</span><span class="params">(addr, typename, ...)</span></span></span><br><span class="line">	...</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>其接受<em>服务地址，消息类型</em>作为参数，调用 打包函数 <code>p.pack(...)</code>打包后调用<code>c.send(addr, p.id, nil, p.pack(...))</code>发送到对应的地址。同样我们在 <code>lualib/skynet.lua</code>，预先注册了几个协议类型：</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- lualib/skynet.lua</span></span><br><span class="line"><span class="keyword">local</span> skynet = &#123;</span><br><span class="line">        <span class="comment">-- read skynet.h</span></span><br><span class="line">        PTYPE_TEXT = <span class="number">0</span>,</span><br><span class="line">        PTYPE_RESPONSE = <span class="number">1</span>,</span><br><span class="line">        PTYPE_MULTICAST = <span class="number">2</span>,</span><br><span class="line">        PTYPE_CLIENT = <span class="number">3</span>,</span><br><span class="line">        PTYPE_SYSTEM = <span class="number">4</span>,</span><br><span class="line">        PTYPE_HARBOR = <span class="number">5</span>,</span><br><span class="line">        PTYPE_SOCKET = <span class="number">6</span>,</span><br><span class="line">        PTYPE_ERROR = <span class="number">7</span>,</span><br><span class="line">        PTYPE_QUEUE = <span class="number">8</span>,        <span class="comment">-- used in deprecated mqueue, use skynet.queue instead</span></span><br><span class="line">        PTYPE_DEBUG = <span class="number">9</span>,</span><br><span class="line">        PTYPE_LUA = <span class="number">10</span>,</span><br><span class="line">        PTYPE_SNAX = <span class="number">11</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">skynet.pack = <span class="built_in">assert</span>(c.pack)</span><br><span class="line">skynet.packstring = <span class="built_in">assert</span>(c.packstring)</span><br><span class="line">skynet.<span class="built_in">unpack</span> = <span class="built_in">assert</span>(c.<span class="built_in">unpack</span>)</span><br><span class="line">skynet.<span class="built_in">tostring</span> = <span class="built_in">assert</span>(c.<span class="built_in">tostring</span>)</span><br><span class="line">skynet.trash = <span class="built_in">assert</span>(c.trash)</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> REG = skynet.register_protocol</span><br><span class="line"></span><br><span class="line">        REG &#123;</span><br><span class="line">                name = <span class="string">"lua"</span>,</span><br><span class="line">                id = skynet.PTYPE_LUA,</span><br><span class="line">                pack = skynet.pack,</span><br><span class="line">                <span class="built_in">unpack</span> = skynet.<span class="built_in">unpack</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        REG &#123;</span><br><span class="line">                name = <span class="string">"response"</span>,</span><br><span class="line">                id = skynet.PTYPE_RESPONSE,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        REG &#123;</span><br><span class="line">                name = <span class="string">"error"</span>,</span><br><span class="line">                id = skynet.PTYPE_ERROR,</span><br><span class="line">                <span class="built_in">unpack</span> = <span class="function"><span class="keyword">function</span><span class="params">(...)</span></span> <span class="keyword">return</span> ... <span class="keyword">end</span>,</span><br><span class="line">                dispatch = _error_dispatch,</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>分别是 <em>lua, response, error</em> 三种协议已经是预注册的，同时其使用了对应的打包与解包函数。对于我们常用的 <em>lua</em> 类型的消息，去使用的是 <em>c.pack,  c.unpack</em> 两个函数进行消息的打包与解包。</p>
<h1 id="launcher-lua"><a href="#launcher-lua" class="headerlink" title="launcher.lua"></a>launcher.lua</h1><p>再来看看<code>launcher.lua</code>，其定义在 <code>service</code>目录下：</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- service/launcher.lua</span></span><br><span class="line"></span><br><span class="line">skynet.dispatch(<span class="string">"lua"</span>, <span class="function"><span class="keyword">function</span><span class="params">(session, address, cmd , ...)</span></span></span><br><span class="line">        cmd = <span class="built_in">string</span>.<span class="built_in">upper</span>(cmd)</span><br><span class="line">        <span class="keyword">local</span> f = command[cmd]</span><br><span class="line">        <span class="keyword">if</span> f <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">local</span> ret = f(address, ...)</span><br><span class="line">                <span class="keyword">if</span> ret ~= NORET <span class="keyword">then</span></span><br><span class="line">                        skynet.ret(skynet.pack(ret))</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                skynet.ret(skynet.pack &#123;<span class="string">"Unknown command"</span>&#125; )</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">launch_service</span><span class="params">(service, ...)</span></span></span><br><span class="line">        <span class="keyword">local</span> param = <span class="built_in">table</span>.<span class="built_in">concat</span>(&#123;...&#125;, <span class="string">" "</span>)</span><br><span class="line">        <span class="keyword">local</span> inst = skynet.launch(service, param)</span><br><span class="line">        <span class="keyword">local</span> response = skynet.response()</span><br><span class="line">        <span class="keyword">if</span> inst <span class="keyword">then</span></span><br><span class="line">                services[inst] = service .. <span class="string">" "</span> .. param</span><br><span class="line">                instance[inst] = response</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                response(<span class="literal">false</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">return</span> inst</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">command.LAUNCH</span><span class="params">(_, service, ...)</span></span></span><br><span class="line">        launch_service(service, ...)</span><br><span class="line">        <span class="keyword">return</span> NORET</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>其首先注册了一个消息分发函数，对于 <code>LAUNCH</code>的命令，最终还是通过 <code>skynet.launch</code>来启动对应的C服务。我们来完整的看一下这个过程：</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">	skynet.newservice(<span class="string">"srv"</span>)</span><br><span class="line">	skynet.call(<span class="string">".launcher"</span>, <span class="string">"lua"</span> , <span class="string">"LAUNCH"</span>, <span class="string">"snlua"</span>, <span class="string">"srv"</span>, ...)</span><br><span class="line">	c.send(<span class="string">".launcher"</span>, p.id , <span class="literal">nil</span> , p.pack(<span class="string">"LAUNCH"</span>, <span class="string">"snlua"</span>, name, ...))</span><br><span class="line">	command.LAUNCH(_, <span class="string">"snlua"</span>, <span class="string">"srv"</span>, ...)</span><br><span class="line">	launch_service(<span class="string">"snlua"</span>, <span class="string">"srv"</span>, ...)</span><br><span class="line">	skynet.launch(<span class="string">"snlua"</span>, <span class="built_in">table</span>.<span class="built_in">concat</span>(&#123;<span class="string">"srv"</span>, ...&#125;, <span class="string">" "</span>&#125;)</span><br><span class="line">```	</span><br><span class="line">最终，还是调用了 skynet.launch 来进行启动服务。</span><br><span class="line"># 初始化</span><br><span class="line">我们可以看到，在`bootstrap.lua 和 main.lua`中，都有类似代码：</span><br><span class="line"></span><br><span class="line">```lua</span><br><span class="line">skynet.start(<span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">        <span class="keyword">local</span> sharestring = <span class="built_in">tonumber</span>(skynet.<span class="built_in">getenv</span> <span class="string">"sharestring"</span> <span class="keyword">or</span> <span class="number">4096</span>)</span><br><span class="line">        memory.ssexpand(sharestring)</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<p>类似的代码，其实，任何一个服务都是以<code>skynet.start(function() ... end)</code>这样的形式进行初始化的。</p>
<p>当然，其实我们在<code>main.lua</code>中，也可以通过 <code>skynet.newservice(name, ...)</code>来启动新的服务。</p>
<h1 id="消息分发与回应"><a href="#消息分发与回应" class="headerlink" title="消息分发与回应"></a>消息分发与回应</h1><p>当一个服务加载，初始化，然后就开始工作了。和大多数的服务一样，其实skynet中的服务做的事情也没有什么特别的。也就是接收消息，处理消息，给出响应这样的操作。</p>
<p>每个服务分三个运行阶段：</p>
<ul>
<li><p>首先是服务加载阶段，当服务的源文件被加载时，就会按 lua 的运行规则被执行到。这个阶段不可以调用任何有可能阻塞住该服务的 skynet api 。因为，在这个阶段中，和服务配套的 skynet 设置并没有初始化完毕。</p>
</li>
<li><p>然后是服务初始化阶段，由 skynet.start 这个 api 注册的初始化函数执行。这个初始化函数理论上可以调用任何 skynet api 了，但启动该服务的 skynet.newservice 这个 api 会一直等待到初始化函数结束才会返回。</p>
</li>
<li><p>最后是服务工作阶段，当你在初始化阶段注册了消息处理函数的话，只要有消息输入，就会触发注册的消息处理函数。这些消息都是 skynet 内部消息，外部的网络数据，定时器也会通过内部消息的形式表达出来。</p>
</li>
</ul>
<p>消息处理器，是通过函数<code>skynet.dispatch</code>来进行注册的，在多数的服务文件中都能看到类似代码：</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> CMD = &#123;&#125;</span><br><span class="line">        skynet.start(<span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">                skynet.dispatch(<span class="string">"lua"</span>, <span class="function"><span class="keyword">function</span> <span class="params">(_, address, cmd, ...)</span></span></span><br><span class="line">                        <span class="keyword">local</span> f = CMD[cmd]</span><br><span class="line">                        <span class="keyword">if</span> f <span class="keyword">then</span></span><br><span class="line">                                skynet.ret(skynet.pack(f(address, ...)))</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                                skynet.ret(skynet.pack(handler.command(cmd, address, ...)))</span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">end</span>)</span><br><span class="line">        <span class="keyword">end</span>)</span><br></pre></td></tr></table></figure>
<p>如上所示代码中：</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">skynet.dispatch(<span class="string">"lua"</span>, <span class="function"><span class="keyword">function</span> <span class="params">(_, address, cmd, ...)</span></span></span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">end</span>)</span><br></pre></td></tr></table></figure>
<p>就是将<strong>lua</strong>类型的消息，注册给后面的匿名函数处理，每次收到<strong>lua</strong>类型的函数时，就会调用这个函数。</p>
<p><strong>通常约定 lua 类消息的第一个元素是一个字符串，表示具体消息对应的操作</strong>。我们会在脚本中创建一个 CMD 表，把对应的操作函数定义在表中。每条 lua 消息抵达后，从 CMD 表中查到处理函数，并把余下的参数传入。这个消息的 session 和　source 可以不必传递给处理函数，因为除了主动向 source 发送类别为 “response” 的消息来回应它以外，还有更简单的方法。框架记忆了这两个值。</p>
<p>这仅仅是一个惯用法，你也可以用其它方法来处理消息。skynet 并未规定你必须怎样做。</p>
<p>每个服务最重要的功能就是处理收到的消息，并根据消息产生特定的动作。每个消息都由五个元素构成：</p>
<ul>
<li><strong>session</strong>：大部分消息工作在请求回应模式下。即，一个服务向另一个服务发起一个请求，而后收到请求的服务在处理完请求消息后，回复一条消息。session 是由发起请求的服务生成的，对它自己唯一的消息标识。回应方在回应时，将 session 带回。这样发送方才能识别出哪条消息是针对哪条的回应。session 是一个非负整数，当一条消息不需要回应时，按惯例，使用 0 这个特殊的 session 号。session 由 skynet 框架生成管理，通常不需要使用者关心。</li>
<li><strong>source</strong>：消息源。每个服务都由一个 32bit 整数标识。这个整数可以看成是服务在 skynet 系统中的地址。即使在服务退出后，新启动的服务通常也不会使用已用过的地址（除非发生回绕，但一般间隔时间非常长）。每条收到的消息都携带有 source ，方便在回应的时候可以指定地址。但地址的管理通常由框架完成，用户不用关心。</li>
<li><strong>type</strong>：消息类别。每个服务可以接收 256 种不同类别的消息。每种类别可以有不同的消息编码格式。有十几种类别是框架保留的，通常也不建议用户定义新的消息类别。因为用户完全可以利用已有的类别，而用具体的消息内容来区分每条具体的含义。框架把这些 type 映射为字符串便于记忆。最常用的消息类别名为 “lua” 广泛用于用 lua 编写的 skynet 服务间的通讯。</li>
<li><strong>messsage</strong>：消息的 C 指针，在 Lua 层看来是一个 lightuserdata 。框架会隐藏这个细节，最终用户处理的是经过解码过的 lua 对象。只有极少情况，你才需要在 lua 层直接操作这个指针。</li>
<li><strong>size</strong>：消息的长度。通常和 message 一起结合起来使用。</li>
</ul>
<h1 id="消息发送"><a href="#消息发送" class="headerlink" title="消息发送"></a>消息发送</h1><p>有两个API可以进行消息的发送：<code>skynet.call,  skynet.send</code>。</p>
<p><code>skynet.send(address, typename, ...)</code>这条 API 可以把一条类别为 typename 的消息发送给 address 。它会先经过事先注册的 pack 函数打包 … 的内容。</p>
<p>skynet.send 是一条非阻塞 API ，发送完消息后，coroutine 会继续向下运行，这期间服务不会重入。</p>
<p><code>skynet.call(address, typename, ...)</code> 这条 API 则不同，它会在内部生成一个唯一 session ，并向 address 提起请求，并阻塞等待对 session 的回应（可以不由 address 回应）。当消息回应后，还会通过之前注册的 unpack 函数解包。表面上看起来，就是发起了一次 RPC ，并阻塞等待回应。call 不支持超时。</p>
<p>尤其需要留意的是，skynet.call 仅仅阻塞住当前的 coroutine ，而没有阻塞整个服务。在等待回应期间，服务照样可以响应其他请求。<strong>所以，尤其要注意，在 skynet.call 之前获得的服务内的状态，到返回后，很有可能改变。</strong></p>
</div><div class="tags"><a href="/tags/Lua/">Lua</a><a href="/tags/skynet/">skynet</a></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/Lua/skynet-任务调度及消息处理.html" class="pre">skynet-任务调度及消息处理</a><a href="/Lua/lua中的表及面向对象.html" class="next">lua中的表及面向对象</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#项目"><span class="toc-text">项目</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#简介"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#服务的三个阶段"><span class="toc-text">服务的三个阶段</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#启动过程"><span class="toc-text">启动过程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#config-lua"><span class="toc-text">config.lua</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#logger"><span class="toc-text">logger</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#snlua"><span class="toc-text">snlua</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bootstrap"><span class="toc-text">bootstrap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#skynet-core"><span class="toc-text">skynet.core</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#不同"><span class="toc-text">不同</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#skynet-call"><span class="toc-text">skynet.call</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#launcher-lua"><span class="toc-text">launcher.lua</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#消息分发与回应"><span class="toc-text">消息分发与回应</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#消息发送"><span class="toc-text">消息发送</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/Android/对于TextView或者普通的View应用Selector.html">对于TextView或者普通的View应用Selector</a></li><li class="post-list-item"><a class="post-list-link" href="/Linux/Bash中对字符的操作.html">Bash中对字符的操作</a></li><li class="post-list-item"><a class="post-list-link" href="/GTD/用OminiFocus做一个自己的事务管理系统.html">用OminiFocus做一个自己的事务管理系统</a></li><li class="post-list-item"><a class="post-list-link" href="/Android/FragmentTabHost的使用.html">FragmentTabHost的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/Android/Android中APP的启动过程.html">Android中APP的启动过程</a></li><li class="post-list-item"><a class="post-list-link" href="/Android/Android数据的存储方式.html">Android数据的存储方式</a></li><li class="post-list-item"><a class="post-list-link" href="/Java/Java内部类与嵌套类.html">Java内部类与嵌套类</a></li><li class="post-list-item"><a class="post-list-link" href="/Java/使用ThreadPool进行线程管理.html">使用ThreadPool进行线程管理</a></li><li class="post-list-item"><a class="post-list-link" href="/MySQL/MySQL存储过程中的游标.html">MySQL存储过程中的游标</a></li><li class="post-list-item"><a class="post-list-link" href="/JavaScript/Vue开发使用ESLint-Vuter-Prettier来进行代码格式化与检查.html">Vue开发使用ESLint-Vuter-Prettier来进行代码格式化与检查</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AIX/">AIX</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">29</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Cocos-Creator/">Cocos Creator</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Cocos2d-X/">Cocos2d-X</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Device/">Device</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/GTD/">GTD</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Golang/">Golang</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">33</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kindle/">Kindle</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">24</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Lua/">Lua</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Novel/">Novel</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Office/">Office</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Oracle/">Oracle</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SED-AWK/">SED&AWK</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Shell/">Shell</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TensorFlow/">TensorFlow</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Vim/">Vim</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Work/">Work</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/macOS/">macOS</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂项/">杂项</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程/">编程</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/Bash/" style="font-size: 15px;">Bash</a> <a href="/tags/curl/" style="font-size: 15px;">curl</a> <a href="/tags/装修/" style="font-size: 15px;">装修</a> <a href="/tags/brew/" style="font-size: 15px;">brew</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Word/" style="font-size: 15px;">Word</a> <a href="/tags/Office/" style="font-size: 15px;">Office</a> <a href="/tags/弯头/" style="font-size: 15px;">弯头</a> <a href="/tags/管件/" style="font-size: 15px;">管件</a> <a href="/tags/水管/" style="font-size: 15px;">水管</a> <a href="/tags/sed/" style="font-size: 15px;">sed</a> <a href="/tags/Golang/" style="font-size: 15px;">Golang</a> <a href="/tags/编程/" style="font-size: 15px;">编程</a> <a href="/tags/Lua/" style="font-size: 15px;">Lua</a> <a href="/tags/Cocos2d-X/" style="font-size: 15px;">Cocos2d-X</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/LVM/" style="font-size: 15px;">LVM</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/android-studio/" style="font-size: 15px;">android studio</a> <a href="/tags/svn/" style="font-size: 15px;">svn</a> <a href="/tags/android/" style="font-size: 15px;">android</a> <a href="/tags/word/" style="font-size: 15px;">word</a> <a href="/tags/REST/" style="font-size: 15px;">REST</a> <a href="/tags/Maven/" style="font-size: 15px;">Maven</a> <a href="/tags/VNC/" style="font-size: 15px;">VNC</a> <a href="/tags/Docx/" style="font-size: 15px;">Docx</a> <a href="/tags/SSH/" style="font-size: 15px;">SSH</a> <a href="/tags/X5/" style="font-size: 15px;">X5</a> <a href="/tags/Tbs/" style="font-size: 15px;">Tbs</a> <a href="/tags/Cocos-Creator/" style="font-size: 15px;">Cocos Creator</a> <a href="/tags/Cocos-Js/" style="font-size: 15px;">Cocos-Js</a> <a href="/tags/Cocos-Creator/" style="font-size: 15px;">Cocos-Creator</a> <a href="/tags/TensorFlow/" style="font-size: 15px;">TensorFlow</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/机器学习/" style="font-size: 15px;">机器学习</a> <a href="/tags/ML/" style="font-size: 15px;">ML</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/杂项/" style="font-size: 15px;">杂项</a> <a href="/tags/Oracle/" style="font-size: 15px;">Oracle</a> <a href="/tags/macOS/" style="font-size: 15px;">macOS</a> <a href="/tags/Sqlplus/" style="font-size: 15px;">Sqlplus</a> <a href="/tags/Application/" style="font-size: 15px;">Application</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/apache/" style="font-size: 15px;">apache</a> <a href="/tags/Dagger/" style="font-size: 15px;">Dagger</a> <a href="/tags/Network/" style="font-size: 15px;">Network</a> <a href="/tags/PAC/" style="font-size: 15px;">PAC</a> <a href="/tags/SQL/" style="font-size: 15px;">SQL</a> <a href="/tags/NFS/" style="font-size: 15px;">NFS</a> <a href="/tags/SVN/" style="font-size: 15px;">SVN</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Promise/" style="font-size: 15px;">Promise</a> <a href="/tags/Pomelo/" style="font-size: 15px;">Pomelo</a> <a href="/tags/Retrofit/" style="font-size: 15px;">Retrofit</a> <a href="/tags/The-Java-Tutorial/" style="font-size: 15px;">The Java Tutorial</a> <a href="/tags/Closure/" style="font-size: 15px;">Closure</a> <a href="/tags/skynet/" style="font-size: 15px;">skynet</a> <a href="/tags/epoll/" style="font-size: 15px;">epoll</a> <a href="/tags/select/" style="font-size: 15px;">select</a> <a href="/tags/poll/" style="font-size: 15px;">poll</a> <a href="/tags/rsync/" style="font-size: 15px;">rsync</a> <a href="/tags/Gradle/" style="font-size: 15px;">Gradle</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/GTD/" style="font-size: 15px;">GTD</a> <a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/Vim/" style="font-size: 15px;">Vim</a> <a href="/tags/Selector/" style="font-size: 15px;">Selector</a> <a href="/tags/CPU/" style="font-size: 15px;">CPU</a> <a href="/tags/8086/" style="font-size: 15px;">8086</a> <a href="/tags/内存管理/" style="font-size: 15px;">内存管理</a> <a href="/tags/Work/" style="font-size: 15px;">Work</a> <a href="/tags/AAA/" style="font-size: 15px;">AAA</a> <a href="/tags/AIX/" style="font-size: 15px;">AIX</a> <a href="/tags/IPSec/" style="font-size: 15px;">IPSec</a> <a href="/tags/加固/" style="font-size: 15px;">加固</a> <a href="/tags/RegEx/" style="font-size: 15px;">RegEx</a> <a href="/tags/正则表达式/" style="font-size: 15px;">正则表达式</a> <a href="/tags/POSIX/" style="font-size: 15px;">POSIX</a> <a href="/tags/Kindle/" style="font-size: 15px;">Kindle</a> <a href="/tags/小说/" style="font-size: 15px;">小说</a> <a href="/tags/F5/" style="font-size: 15px;">F5</a> <a href="/tags/负载均衡/" style="font-size: 15px;">负载均衡</a> <a href="/tags/FTP/" style="font-size: 15px;">FTP</a> <a href="/tags/awk/" style="font-size: 15px;">awk</a> <a href="/tags/iptables/" style="font-size: 15px;">iptables</a> <a href="/tags/越狱/" style="font-size: 15px;">越狱</a> <a href="/tags/阅读/" style="font-size: 15px;">阅读</a> <a href="/tags/Cron/" style="font-size: 15px;">Cron</a> <a href="/tags/Unix/" style="font-size: 15px;">Unix</a> <a href="/tags/Go/" style="font-size: 15px;">Go</a> <a href="/tags/网络/" style="font-size: 15px;">网络</a> <a href="/tags/OSPF/" style="font-size: 15px;">OSPF</a> <a href="/tags/OpenSSH/" style="font-size: 15px;">OpenSSH</a> <a href="/tags/OpenSSL/" style="font-size: 15px;">OpenSSL</a> <a href="/tags/数据库/" style="font-size: 15px;">数据库</a> <a href="/tags/Oralce/" style="font-size: 15px;">Oralce</a> <a href="/tags/视图/" style="font-size: 15px;">视图</a> <a href="/tags/Device/" style="font-size: 15px;">Device</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">Gowa2017 Zhang.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script></body></html>