<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  
  <title>使用Retrofit-Rxjava来上传下载文件 | 退思园</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="使用 Http 协议进行文件传输的时候，需要了解一些必要的知识，然后才能配合使用 Retrofit 和 RxJava 来进行操作。">
<meta name="keywords" content="Java,Android,RxJava">
<meta property="og:type" content="article">
<meta property="og:title" content="使用Retrofit-Rxjava来上传下载文件">
<meta property="og:url" content="https://gowa.club/RxJava/使用Retrofit-Rxjava来上传下载文件.html">
<meta property="og:site_name" content="退思园">
<meta property="og:description" content="使用 Http 协议进行文件传输的时候，需要了解一些必要的知识，然后才能配合使用 Retrofit 和 RxJava 来进行操作。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-07-31T03:43:28.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用Retrofit-Rxjava来上传下载文件">
<meta name="twitter:description" content="使用 Http 协议进行文件传输的时候，需要了解一些必要的知识，然后才能配合使用 Retrofit 和 RxJava 来进行操作。">
  
    <link rel="alternate" href="/atom.xml" title="退思园" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">退思园</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">烦恼一般都是想太多了。</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://gowa.club"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-使用Retrofit-Rxjava来上传下载文件" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/RxJava/使用Retrofit-Rxjava来上传下载文件.html" class="article-date">
  <time class="dt-published" datetime="2019-07-31T03:43:28.000Z" itemprop="datePublished">2019-07-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/RxJava/">RxJava</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      使用Retrofit-Rxjava来上传下载文件
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>使用 Http 协议进行文件传输的时候，需要了解一些必要的知识，然后才能配合使用 Retrofit 和 RxJava 来进行操作。</p>
<a id="more"></a>
<h1 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h1><p>首先，HTTP 是一个超文本传输协议，以就是说，这个协议，是用来交互文本的，而不是二进制流的。我们必须把我们的文件转换成文本形式，才能进行传输。</p>
<p>RFC7230 定义了此协议。</p>
<h2 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h2><h3 id="URI"><a href="#URI" class="headerlink" title="URI"></a>URI</h3><p>URI （uniform resource identifier） 是统一资源标识符的意思。可以用来唯一的标识一个资源。</p>
<p>一般由三部分组成：</p>
<p>URI一般由三部组成：</p>
<ul>
<li>①访问资源的命名机制</li>
<li>②存放资源的主机名</li>
<li>③资源自身的名称，由路径表示，着重强调于资源。<h3 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h3></li>
</ul>
<p>URL 是（Uniform Resource locator） 是统一资源定位器的意思，其也是一种 URI 的实现，其不仅指定了资源的标识，还指明了如何定位资源。</p>
<p>一般也是由三部分组成：</p>
<ul>
<li>①协议(或称为服务方式)</li>
<li>②存有该资源的主机IP地址(有时也包括端口号)</li>
<li>③主机资源的具体地址。如目录和文件名等</li>
</ul>
<h3 id="URN"><a href="#URN" class="headerlink" title="URN"></a>URN</h3><p>URN，uniform resource name，统一资源命名，是通过名字来标识资源，比如mailto:java-net@java.sun.com。</p>
<h2 id="消息格式"><a href="#消息格式" class="headerlink" title="消息格式"></a>消息格式</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">start-line(method SP request-target SP HTTP-version CRLF/HTTP-version SP status-code SP reason-phrase CRLF)</span><br><span class="line">*( header-field CRLF )</span><br><span class="line">CRLF</span><br><span class="line">[ message-body ](message-body = *OCTET)</span><br></pre></td></tr></table></figure>
<p>什么时候允许出现 message-body 在请求和响应消息中是不同的。</p>
<p>在请求中，如果 Header 有一个 Content-Length 或 Transfer-Encoding  字段，就表示会有一个 Body。请求消息的结构和方法的语义是相互独立的，因此及时方法没有定义会使用  message-body 其也可能会出现。</p>
<p>响应消息中是否会出现 message-body 与 其对应的请求和响应的状态码有关。</p>
<h2 id="multipart-form-data"><a href="#multipart-form-data" class="headerlink" title="multipart/form-data"></a>multipart/form-data</h2><p>RFC 7578 定义了 multipart/form-data 媒体类型。对于  message-body 中是一个 multipart/form-data 的数据时，其是由很多分隔符分开的部分组成的。</p>
<ul>
<li>Boundary 类似 “CRLF — Boundary”</li>
<li>Content-Disposition 每个部分都会有这个字段，其类型是 form-data，同时包含一个额外的参数 “name”，表示从表单中初始的字段名。<code>Content-Disposition: form-data; name=&quot;user&quot;</code> 对于文件的话，可以用 filename 来替代 name，但有的时候这个参数没有意义，可能不会识别它，看服务器来决定。</li>
<li>Content-Type 可能会有，默认是 text/plain。如果发送的是文件的时候，那么默认的会是 application/octet-stream。</li>
</ul>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--AaB03x</span><br><span class="line">content-disposition: form-data; name=&quot;field1&quot;</span><br><span class="line">content-type: text/plain;charset=UTF-8</span><br><span class="line">content-transfer-encoding: quoted-printable</span><br><span class="line"></span><br><span class="line">Joe owes =E2=82=AC100.</span><br><span class="line">--AaB03x</span><br></pre></td></tr></table></figure>
<h1 id="Retrofit-实现上传"><a href="#Retrofit-实现上传" class="headerlink" title="Retrofit 实现上传"></a>Retrofit 实现上传</h1><p>2.0 需要用 OkHttp 的 RequestBody 或者 MultipartBody.Part 来封装我们的文件进行传输。</p>
<ul>
<li>RequestBody 包含数据流，contentType, contentLength</li>
<li>MultipartBody.Part 对 RequestBody 进行封装。事实上就是加上 <code>content-disposition: form-data; name=&quot;field1&quot;; filename=&quot;field&quot;</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/** Returns a new request body that transmits the content of &#123;<span class="doctag">@code</span> file&#125;. */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RequestBody <span class="title">create</span><span class="params">(<span class="keyword">final</span> @Nullable MediaType contentType, <span class="keyword">final</span> File file)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (file == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"file == null"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> RequestBody() &#123;</span><br><span class="line">    <span class="meta">@Override</span> <span class="keyword">public</span> <span class="meta">@Nullable</span> <span class="function">MediaType <span class="title">contentType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> contentType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">contentLength</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> file.length();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeTo</span><span class="params">(BufferedSink sink)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      Source source = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        source = Okio.source(file);</span><br><span class="line">        sink.writeAll(source);</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        Util.closeQuietly(source);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Part <span class="title">createFormData</span><span class="params">(String name, @Nullable String filename, RequestBody body)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (name == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"name == null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    StringBuilder disposition = <span class="keyword">new</span> StringBuilder(<span class="string">"form-data; name="</span>);</span><br><span class="line">    appendQuotedString(disposition, name);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (filename != <span class="keyword">null</span>) &#123;</span><br><span class="line">      disposition.append(<span class="string">"; filename="</span>);</span><br><span class="line">      appendQuotedString(disposition, filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> create(Headers.of(<span class="string">"Content-Disposition"</span>, disposition.toString()), body);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Part <span class="title">createFormData</span><span class="params">(String name, @Nullable String filename, RequestBody body)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (name == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"name == null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    StringBuilder disposition = <span class="keyword">new</span> StringBuilder(<span class="string">"form-data; name="</span>);</span><br><span class="line">    appendQuotedString(disposition, name);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (filename != <span class="keyword">null</span>) &#123;</span><br><span class="line">      disposition.append(<span class="string">"; filename="</span>);</span><br><span class="line">      appendQuotedString(disposition, filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> create(Headers.of(<span class="string">"Content-Disposition"</span>, disposition.toString()), body);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>可以看到  formdata 实际上就是将多个 RequestBody 封装成 Part 然后进行传输了。</p>
<p>一般来说，2.0会以下面的形式进行上传文件：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FileUploadService</span> </span>&#123;  </span><br><span class="line">    <span class="meta">@Multipart</span></span><br><span class="line">    <span class="meta">@POST</span>(<span class="string">"upload"</span>)</span><br><span class="line">    <span class="function">Call&lt;ResponseBody&gt; <span class="title">upload</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        @Part(<span class="string">"description"</span>)</span> RequestBody description,</span></span><br><span class="line"><span class="function">        @Part MultipartBody.Part file</span></span><br><span class="line"><span class="function">    )</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">## 服务端代码</span><br><span class="line"></span><br><span class="line">​```js</span><br><span class="line">method: <span class="string">'POST'</span>,  </span><br><span class="line">path: <span class="string">'/upload'</span>,  </span><br><span class="line">config: &#123;  </span><br><span class="line">    payload: &#123;</span><br><span class="line">        maxBytes: <span class="number">209715200</span>,</span><br><span class="line">        output: <span class="string">'stream'</span>,</span><br><span class="line">        parse: <span class="keyword">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    handler: function(request, reply) &#123;</span><br><span class="line">        var multiparty = require(<span class="string">'multiparty'</span>);</span><br><span class="line">        var form = <span class="keyword">new</span> multiparty.Form();</span><br><span class="line">        form.parse(request.payload, function(err, fields, files) &#123;</span><br><span class="line">            console.log(err);</span><br><span class="line">            console.log(fields);</span><br><span class="line">            console.log(files);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> reply(util.inspect(&#123;fields: fields, files: files&#125;));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其将会打印日志：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">null  </span><br><span class="line">&#123; description: [ &apos;hello, this is description speaking&apos; ] &#125;</span><br><span class="line">&#123; picture:</span><br><span class="line">   [ &#123; fieldName: &apos;picture&apos;,</span><br><span class="line">       originalFilename: &apos;20160312_095248.jpg&apos;,</span><br><span class="line">       path: &apos;/var/folders/rq/q_m4_21j3lqf1lw48fqttx_80000gn/T/X_sxX6LDUMBcuUcUGDMBKc2T.jpg&apos;,</span><br><span class="line">       headers: [Object],</span><br><span class="line">       size: 39369 &#125; ] &#125;</span><br></pre></td></tr></table></figure>
<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">uploadFile</span><span class="params">(Uri fileUri)</span> </span>&#123;  </span><br><span class="line">    <span class="comment">// create upload service client</span></span><br><span class="line">    FileUploadService service =</span><br><span class="line">            ServiceGenerator.createService(FileUploadService.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// https://github.com/iPaulPro/aFileChooser/blob/master/aFileChooser/src/com/ipaulpro/afilechooser/utils/FileUtils.java</span></span><br><span class="line">    <span class="comment">// use the FileUtils to get the actual file by uri</span></span><br><span class="line">    File file = FileUtils.getFile(<span class="keyword">this</span>, fileUri);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create RequestBody instance from file</span></span><br><span class="line">    RequestBody requestFile =</span><br><span class="line">            RequestBody.create(</span><br><span class="line">                         MediaType.parse(getContentResolver().getType(fileUri)),</span><br><span class="line">                         file</span><br><span class="line">             );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MultipartBody.Part is used to send also the actual file name</span></span><br><span class="line">    MultipartBody.Part body =</span><br><span class="line">            MultipartBody.Part.createFormData(<span class="string">"picture"</span>, file.getName(), requestFile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// add another part within the multipart request</span></span><br><span class="line">    String descriptionString = <span class="string">"hello, this is description speaking"</span>;</span><br><span class="line">    RequestBody description =</span><br><span class="line">            RequestBody.create(</span><br><span class="line">                    okhttp3.MultipartBody.FORM, descriptionString);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// finally, execute the request</span></span><br><span class="line">    Call&lt;ResponseBody&gt; call = service.upload(description, body);</span><br><span class="line">    call.enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call,</span></span></span><br><span class="line"><span class="function"><span class="params">                               Response&lt;ResponseBody&gt; response)</span> </span>&#123;</span><br><span class="line">            Log.v(<span class="string">"Upload"</span>, <span class="string">"success"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;ResponseBody&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line">            Log.e(<span class="string">"Upload error:"</span>, t.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="OkHttp-的-Source与Sink"><a href="#OkHttp-的-Source与Sink" class="headerlink" title="OkHttp 的 Source与Sink"></a>OkHttp 的 Source与Sink</h1><p>从 RequestBody 的建立代码中，我们看到，实际上是将我们的 File 构造了一个 Source ， 然后写到了一个 Sink 中。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Okio</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Source <span class="title">source</span><span class="params">(File file)</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (file == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"file == null"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> source((InputStream)(<span class="keyword">new</span> FileInputStream(file)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Sink <span class="title">sink</span><span class="params">(File file)</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (file == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"file == null"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> sink((OutputStream)(<span class="keyword">new</span> FileOutputStream(file)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>我们可以简单的将 Source, Sink 看成是输入流或者输入流。虽然其提供了一些很有用很方便有效率的方法，但这不影响我们的讨论。</p>
<p>我们来看一下 OkHttp 是怎么样发送请求的，在 CallServerInterceptor 中，最终发生网络请求，发送数据：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  RealInterceptorChain realChain = (RealInterceptorChain) chain;</span><br><span class="line">  HttpCodec httpCodec = realChain.httpStream();</span><br><span class="line">  StreamAllocation streamAllocation = realChain.streamAllocation();</span><br><span class="line">  RealConnection connection = (RealConnection) realChain.connection();</span><br><span class="line">  Request request = realChain.request();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">long</span> sentRequestMillis = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">  realChain.eventListener().requestHeadersStart(realChain.call());</span><br><span class="line">  httpCodec.writeRequestHeaders(request);</span><br><span class="line">  realChain.eventListener().requestHeadersEnd(realChain.call(), request);</span><br><span class="line"></span><br><span class="line">  Response.Builder responseBuilder = <span class="keyword">null</span>;</span><br><span class="line">  <span class="comment">// 如果 Post 方法，且含有一个 Body</span></span><br><span class="line">  <span class="keyword">if</span> (HttpMethod.permitsRequestBody(request.method()) &amp;&amp; request.body() != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">// If there's a "Expect: 100-continue" header on the request, wait for a "HTTP/1.1 100</span></span><br><span class="line">    <span class="comment">// Continue" response before transmitting the request body. If we don't get that, return</span></span><br><span class="line">    <span class="comment">// what we did get (such as a 4xx response) without ever transmitting the request body.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"100-continue"</span>.equalsIgnoreCase(request.header(<span class="string">"Expect"</span>))) &#123;</span><br><span class="line">      httpCodec.flushRequest();</span><br><span class="line">      realChain.eventListener().responseHeadersStart(realChain.call());</span><br><span class="line">      responseBuilder = httpCodec.readResponseHeaders(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (responseBuilder == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="comment">// Write the request body if the "Expect: 100-continue" expectation was met.</span></span><br><span class="line">      realChain.eventListener().requestBodyStart(realChain.call());</span><br><span class="line">      <span class="keyword">long</span> contentLength = request.body().contentLength();</span><br><span class="line">      CountingSink requestBodyOut =</span><br><span class="line">          <span class="keyword">new</span> CountingSink(httpCodec.createRequestBody(request, contentLength));</span><br><span class="line">      BufferedSink bufferedRequestBody = Okio.buffer(requestBodyOut);</span><br><span class="line"></span><br><span class="line">      request.body().writeTo(bufferedRequestBody);</span><br><span class="line">      bufferedRequestBody.close();</span><br><span class="line">      realChain.eventListener()</span><br><span class="line">          .requestBodyEnd(realChain.call(), requestBodyOut.successfulCount);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!connection.isMultiplexed()) &#123;</span><br><span class="line">      <span class="comment">// If the "Expect: 100-continue" expectation wasn't met, prevent the HTTP/1 connection</span></span><br><span class="line">      <span class="comment">// from being reused. Otherwise we're still obligated to transmit the request body to</span></span><br><span class="line">      <span class="comment">// leave the connection in a consistent state.</span></span><br><span class="line">      streamAllocation.noNewStreams();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  httpCodec.finishRequest();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (responseBuilder == <span class="keyword">null</span>) &#123;</span><br><span class="line">    realChain.eventListener().responseHeadersStart(realChain.call());</span><br><span class="line">    responseBuilder = httpCodec.readResponseHeaders(<span class="keyword">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Response response = responseBuilder</span><br><span class="line">      .request(request)</span><br><span class="line">      .handshake(streamAllocation.connection().handshake())</span><br><span class="line">      .sentRequestAtMillis(sentRequestMillis)</span><br><span class="line">      .receivedResponseAtMillis(System.currentTimeMillis())</span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> code = response.code();</span><br><span class="line">  <span class="keyword">if</span> (code == <span class="number">100</span>) &#123;</span><br><span class="line">    <span class="comment">// server sent a 100-continue even though we did not request one.</span></span><br><span class="line">    <span class="comment">// try again to read the actual response</span></span><br><span class="line">    responseBuilder = httpCodec.readResponseHeaders(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">    response = responseBuilder</span><br><span class="line">            .request(request)</span><br><span class="line">            .handshake(streamAllocation.connection().handshake())</span><br><span class="line">            .sentRequestAtMillis(sentRequestMillis)</span><br><span class="line">            .receivedResponseAtMillis(System.currentTimeMillis())</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    code = response.code();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  realChain.eventListener()</span><br><span class="line">          .responseHeadersEnd(realChain.call(), response);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (forWebSocket &amp;&amp; code == <span class="number">101</span>) &#123;</span><br><span class="line">    <span class="comment">// Connection is upgrading, but we need to ensure interceptors see a non-null response body.</span></span><br><span class="line">    response = response.newBuilder()</span><br><span class="line">        .body(Util.EMPTY_RESPONSE)</span><br><span class="line">        .build();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    response = response.newBuilder()</span><br><span class="line">        .body(httpCodec.openResponseBody(response))</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">"close"</span>.equalsIgnoreCase(response.request().header(<span class="string">"Connection"</span>))</span><br><span class="line">      || <span class="string">"close"</span>.equalsIgnoreCase(response.header(<span class="string">"Connection"</span>))) &#123;</span><br><span class="line">    streamAllocation.noNewStreams();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ((code == <span class="number">204</span> || code == <span class="number">205</span>) &amp;&amp; response.body().contentLength() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ProtocolException(</span><br><span class="line">        <span class="string">"HTTP "</span> + code + <span class="string">" had non-zero Content-Length: "</span> + response.body().contentLength());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> response;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于代码在于：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">long</span> contentLength = request.body().contentLength();</span><br><span class="line">        CountingSink requestBodyOut =</span><br><span class="line">            <span class="keyword">new</span> CountingSink(httpCodec.createRequestBody(request, contentLength));</span><br><span class="line">        BufferedSink bufferedRequestBody = Okio.buffer(requestBodyOut);</span><br><span class="line"></span><br><span class="line">        request.body().writeTo(bufferedRequestBody);</span><br><span class="line">        bufferedRequestBody.close();</span><br></pre></td></tr></table></figure>
<p>此段代码将我们的 RequestBody 写到一个与连接相关联的 Sink 上，发送数据。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// RealConnection.java</span></span><br><span class="line">      sink = Okio.buffer(Okio.sink(rawSocket));</span><br></pre></td></tr></table></figure>
<p>这个 sink 会在 Http1Code 构建 CountingSink 的时候用到，实际上数据就是写到这里面的。</p>
<p>对于构建的 BufferedSink，其是以 8192 字节每次写入套接字：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// RealBufferedSink.java</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">writeAll</span><span class="params">(Source source)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (source == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"source == null"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">long</span> totalBytesRead = <span class="number">0L</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">long</span> readCount;</span><br><span class="line">            <span class="keyword">while</span>((readCount = source.read(<span class="keyword">this</span>.buffer, <span class="number">8192L</span>)) != -<span class="number">1L</span>) &#123;</span><br><span class="line">                totalBytesRead += readCount;</span><br><span class="line">                <span class="keyword">this</span>.emitCompleteSegments();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> totalBytesRead;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="对于上传文件进度回调的思路"><a href="#对于上传文件进度回调的思路" class="headerlink" title="对于上传文件进度回调的思路"></a>对于上传文件进度回调的思路</h1><p>看了一下谷歌，很多都是在我们将 RequestBody 读出并写到 sink 的时候进行回调：</p>
<p>比如这个地方：<a href="https://github.com/square/okhttp/blob/master/samples/guide/src/main/java/okhttp3/recipes/Progress.java" target="_blank" rel="noopener">okhttp recipes</a> 有类似的思路</p>
<p>上面这个是针对下载的。</p>
<p>而这个就是针对上传来显示进度的：<a href="https://medium.com/@PaulinaSadowska/display-progress-of-multipart-request-with-retrofit-and-rxjava-23a4a779e6ba" target="_blank" rel="noopener">OkHttp 上传显示进度</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gowa.club/RxJava/使用Retrofit-Rxjava来上传下载文件.html" data-id="ck2k5hhzw00t9gm03um18a7j3" data-title="使用Retrofit-Rxjava来上传下载文件" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RxJava/">RxJava</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/RxJava/关于RxJava操作符flatMap与concatMap的探究.html" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          关于RxJava操作符flatMap与concatMap的探究
        
      </div>
    </a>
  
  
    <a href="/Windows/关于Windows的内核对象.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">关于Windows的内核对象</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/Android/Hooking-Linux中的共享库函数.html">Hooking-Linux中的共享库函数</a>
          </li>
        
          <li>
            <a href="/Android/Riru来注入Zygote进程.html">Riru来注入Zygote进程</a>
          </li>
        
          <li>
            <a href="/Android/Android的权限检查过程.html">Android的权限检查过程</a>
          </li>
        
          <li>
            <a href="/Android/Android的服务管理.html">Android的服务管理</a>
          </li>
        
          <li>
            <a href="/Cpp/使用Clang进行交叉编译.html">使用Clang进行交叉编译</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Asm/">Asm</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Cocos-Creator/">Cocos Creator</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Cocos2d-X/">Cocos2d-X</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Cpp/">Cpp</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Device/">Device</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/GTD/">GTD</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Golang/">Golang</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">42</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kindle/">Kindle</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Unix/">Linux/Unix</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Lua/">Lua</a><span class="category-list-count">24</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Misc/">Misc</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RxJava/">RxJava</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/">TCP/IP</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Vim/">Vim</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/macOS/">macOS</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">25</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/AWK/" style="font-size: 10px;">AWK</a> <a href="/tags/Activiti/" style="font-size: 10px;">Activiti</a> <a href="/tags/Aix/" style="font-size: 10.63px;">Aix</a> <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/Apue/" style="font-size: 11.88px;">Apue</a> <a href="/tags/Asm/" style="font-size: 11.88px;">Asm</a> <a href="/tags/Auto-js/" style="font-size: 10px;">Auto.js</a> <a href="/tags/CentOS/" style="font-size: 11.88px;">CentOS</a> <a href="/tags/Cocos-Creator/" style="font-size: 12.5px;">Cocos Creator</a> <a href="/tags/Cocos2d-X/" style="font-size: 13.13px;">Cocos2d-X</a> <a href="/tags/Cpp/" style="font-size: 11.88px;">Cpp</a> <a href="/tags/Curl/" style="font-size: 10.63px;">Curl</a> <a href="/tags/DHCP/" style="font-size: 10px;">DHCP</a> <a href="/tags/Dagger/" style="font-size: 12.5px;">Dagger</a> <a href="/tags/Device/" style="font-size: 10px;">Device</a> <a href="/tags/Docx/" style="font-size: 14.38px;">Docx</a> <a href="/tags/Docx4j/" style="font-size: 10px;">Docx4j</a> <a href="/tags/F5/" style="font-size: 10px;">F5</a> <a href="/tags/GTD/" style="font-size: 10px;">GTD</a> <a href="/tags/Git/" style="font-size: 12.5px;">Git</a> <a href="/tags/Github/" style="font-size: 10px;">Github</a> <a href="/tags/Golang/" style="font-size: 10.63px;">Golang</a> <a href="/tags/Gson/" style="font-size: 10.63px;">Gson</a> <a href="/tags/Hooking/" style="font-size: 10px;">Hooking</a> <a href="/tags/Iptables/" style="font-size: 10px;">Iptables</a> <a href="/tags/JNI/" style="font-size: 10px;">JNI</a> <a href="/tags/Java/" style="font-size: 19.38px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/KVM/" style="font-size: 10px;">KVM</a> <a href="/tags/Kindle/" style="font-size: 10.63px;">Kindle</a> <a href="/tags/LVM/" style="font-size: 10.63px;">LVM</a> <a href="/tags/Linux/" style="font-size: 18.75px;">Linux</a> <a href="/tags/Lsyncd/" style="font-size: 10px;">Lsyncd</a> <a href="/tags/Lua/" style="font-size: 18.13px;">Lua</a> <a href="/tags/MFC/" style="font-size: 13.13px;">MFC</a> <a href="/tags/ML/" style="font-size: 10px;">ML</a> <a href="/tags/MVP/" style="font-size: 10.63px;">MVP</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Maven/" style="font-size: 10px;">Maven</a> <a href="/tags/MySQL/" style="font-size: 16.88px;">MySQL</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/NFS/" style="font-size: 10px;">NFS</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/Node-js/" style="font-size: 10px;">Node.js</a> <a href="/tags/OSPF/" style="font-size: 10px;">OSPF</a> <a href="/tags/Oracle/" style="font-size: 14.38px;">Oracle</a> <a href="/tags/Oralce/" style="font-size: 10px;">Oralce</a> <a href="/tags/PAC/" style="font-size: 10px;">PAC</a> <a href="/tags/PIL/" style="font-size: 15.63px;">PIL</a> <a href="/tags/PPPoE/" style="font-size: 10px;">PPPoE</a> <a href="/tags/Pandas/" style="font-size: 10.63px;">Pandas</a> <a href="/tags/Php/" style="font-size: 10px;">Php</a> <a href="/tags/Poi/" style="font-size: 11.25px;">Poi</a> <a href="/tags/Pomelo/" style="font-size: 11.25px;">Pomelo</a> <a href="/tags/Promise/" style="font-size: 10px;">Promise</a> <a href="/tags/Python/" style="font-size: 14.38px;">Python</a> <a href="/tags/REST/" style="font-size: 10px;">REST</a> <a href="/tags/Raid/" style="font-size: 10px;">Raid</a> <a href="/tags/RegEx/" style="font-size: 10px;">RegEx</a> <a href="/tags/Retrofit/" style="font-size: 11.88px;">Retrofit</a> <a href="/tags/Room/" style="font-size: 10px;">Room</a> <a href="/tags/Rsync/" style="font-size: 10px;">Rsync</a> <a href="/tags/RxJava/" style="font-size: 15px;">RxJava</a> <a href="/tags/SED/" style="font-size: 11.25px;">SED</a> <a href="/tags/SHELL/" style="font-size: 10.63px;">SHELL</a> <a href="/tags/SSH/" style="font-size: 11.25px;">SSH</a> <a href="/tags/Shell/" style="font-size: 13.13px;">Shell</a> <a href="/tags/Skynet/" style="font-size: 12.5px;">Skynet</a> <a href="/tags/So/" style="font-size: 10px;">So</a> <a href="/tags/Spring/" style="font-size: 11.25px;">Spring</a> <a href="/tags/SpringMVC/" style="font-size: 11.25px;">SpringMVC</a> <a href="/tags/Sqlplus/" style="font-size: 10.63px;">Sqlplus</a> <a href="/tags/Svn/" style="font-size: 10.63px;">Svn</a> <a href="/tags/Syslog/" style="font-size: 10px;">Syslog</a> <a href="/tags/TCP-IP/" style="font-size: 12.5px;">TCP/IP</a> <a href="/tags/Tbs/" style="font-size: 10px;">Tbs</a> <a href="/tags/Tcpdump/" style="font-size: 10px;">Tcpdump</a> <a href="/tags/TensorFlow/" style="font-size: 13.75px;">TensorFlow</a> <a href="/tags/The-Java-Tutorial/" style="font-size: 13.13px;">The Java Tutorial</a> <a href="/tags/Thread/" style="font-size: 11.25px;">Thread</a> <a href="/tags/Tomcat/" style="font-size: 10px;">Tomcat</a> <a href="/tags/VIM/" style="font-size: 10px;">VIM</a> <a href="/tags/VNC/" style="font-size: 11.25px;">VNC</a> <a href="/tags/Vim/" style="font-size: 13.13px;">Vim</a> <a href="/tags/Vue/" style="font-size: 10px;">Vue</a> <a href="/tags/Windows/" style="font-size: 17.5px;">Windows</a> <a href="/tags/X5/" style="font-size: 10px;">X5</a> <a href="/tags/YCM/" style="font-size: 10px;">YCM</a> <a href="/tags/YouCompleteMe/" style="font-size: 10px;">YouCompleteMe</a> <a href="/tags/apache/" style="font-size: 10px;">apache</a> <a href="/tags/brew/" style="font-size: 11.88px;">brew</a> <a href="/tags/ffmpeg/" style="font-size: 10px;">ffmpeg</a> <a href="/tags/launchd/" style="font-size: 10px;">launchd</a> <a href="/tags/macOS/" style="font-size: 13.75px;">macOS</a> <a href="/tags/networksetup/" style="font-size: 10px;">networksetup</a> <a href="/tags/php/" style="font-size: 10px;">php</a> <a href="/tags/数据库/" style="font-size: 13.75px;">数据库</a> <a href="/tags/磁盘阵列/" style="font-size: 10px;">磁盘阵列</a> <a href="/tags/设备信息查看/" style="font-size: 10px;">设备信息查看</a> <a href="/tags/负载均衡/" style="font-size: 10px;">负载均衡</a> <a href="/tags/运维/" style="font-size: 17.5px;">运维</a> <a href="/tags/逆向/" style="font-size: 16.25px;">逆向</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">18</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">9</span></li></ul>
    </div>
  </div>


  
</aside>

        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Gowa2017 Zhang<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="/js/jquery-3.4.1.min.js"></script>


  <script src="/fancybox/jquery.fancybox.min.js"></script>


<script src="/js/script.js"></script>




  </div>
</body>
</html>