<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>使用Retrofit-Rxjava来上传下载文件 | 退思园</title><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.3"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.3"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css?v=2.0.3"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js?v=2.0.3"></script><script src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=2.0.3"></script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">使用Retrofit-Rxjava来上传下载文件</h1><a id="logo" href="/.">退思园</a><p class="description">烦恼一般都是想太多了。</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/soft"><i class="fa fa-rss"> soft</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">使用Retrofit-Rxjava来上传下载文件</h1><div class="post-meta"><a href="/RxJava/使用Retrofit-Rxjava来上传下载文件.html#comments" class="comment-count"><i data-disqus-identifier="RxJava/使用Retrofit-Rxjava来上传下载文件.html" class="disqus-comment-count"></i>留言</a><p><span class="date">Jul 31, 2019</span><span><a href="/categories/RxJava/" class="category">RxJava</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>使用 Http 协议进行文件传输的时候，需要了解一些必要的知识，然后才能配合使用 Retrofit 和 RxJava 来进行操作。</p>
<a id="more"></a>
<h1 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h1><p>首先，HTTP 是一个超文本传输协议，以就是说，这个协议，是用来交互文本的，而不是二进制流的。我们必须把我们的文件转换成文本形式，才能进行传输。</p>
<p>RFC7230 定义了此协议。</p>
<h2 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h2><h3 id="URI"><a href="#URI" class="headerlink" title="URI"></a>URI</h3><p>URI （uniform resource identifier） 是统一资源标识符的意思。可以用来唯一的标识一个资源。</p>
<p>一般由三部分组成：</p>
<p>URI一般由三部组成：</p>
<ul>
<li>①访问资源的命名机制</li>
<li>②存放资源的主机名</li>
<li>③资源自身的名称，由路径表示，着重强调于资源。<h3 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h3></li>
</ul>
<p>URL 是（Uniform Resource locator） 是统一资源定位器的意思，其也是一种 URI 的实现，其不仅指定了资源的标识，还指明了如何定位资源。</p>
<p>一般也是由三部分组成：</p>
<ul>
<li>①协议(或称为服务方式)</li>
<li>②存有该资源的主机IP地址(有时也包括端口号)</li>
<li>③主机资源的具体地址。如目录和文件名等</li>
</ul>
<h3 id="URN"><a href="#URN" class="headerlink" title="URN"></a>URN</h3><p>URN，uniform resource name，统一资源命名，是通过名字来标识资源，比如mailto:java-net@java.sun.com。</p>
<h2 id="消息格式"><a href="#消息格式" class="headerlink" title="消息格式"></a>消息格式</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">start-line(method SP request-target SP HTTP-version CRLF/HTTP-version SP status-code SP reason-phrase CRLF)</span><br><span class="line">*( header-field CRLF )</span><br><span class="line">CRLF</span><br><span class="line">[ message-body ](message-body = *OCTET)</span><br></pre></td></tr></table></figure>
<p>什么时候允许出现 message-body 在请求和响应消息中是不同的。</p>
<p>在请求中，如果 Header 有一个 Content-Length 或 Transfer-Encoding  字段，就表示会有一个 Body。请求消息的结构和方法的语义是相互独立的，因此及时方法没有定义会使用  message-body 其也可能会出现。</p>
<p>响应消息中是否会出现 message-body 与 其对应的请求和响应的状态码有关。</p>
<h2 id="multipart-form-data"><a href="#multipart-form-data" class="headerlink" title="multipart/form-data"></a>multipart/form-data</h2><p>RFC 7578 定义了 multipart/form-data 媒体类型。对于  message-body 中是一个 multipart/form-data 的数据时，其是由很多分隔符分开的部分组成的。</p>
<ul>
<li>Boundary 类似 “CRLF — Boundary”</li>
<li>Content-Disposition 每个部分都会有这个字段，其类型是 form-data，同时包含一个额外的参数 “name”，表示从表单中初始的字段名。<code>Content-Disposition: form-data; name=&quot;user&quot;</code> 对于文件的话，可以用 filename 来替代 name，但有的时候这个参数没有意义，可能不会识别它，看服务器来决定。</li>
<li>Content-Type 可能会有，默认是 text/plain。如果发送的是文件的时候，那么默认的会是 application/octet-stream。</li>
</ul>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--AaB03x</span><br><span class="line">content-disposition: form-data; name=&quot;field1&quot;</span><br><span class="line">content-type: text/plain;charset=UTF-8</span><br><span class="line">content-transfer-encoding: quoted-printable</span><br><span class="line"></span><br><span class="line">Joe owes =E2=82=AC100.</span><br><span class="line">--AaB03x</span><br></pre></td></tr></table></figure>
<h1 id="Retrofit-实现上传"><a href="#Retrofit-实现上传" class="headerlink" title="Retrofit 实现上传"></a>Retrofit 实现上传</h1><p>2.0 需要用 OkHttp 的 RequestBody 或者 MultipartBody.Part 来封装我们的文件进行传输。</p>
<ul>
<li>RequestBody 包含数据流，contentType, contentLength</li>
<li>MultipartBody.Part 对 RequestBody 进行封装。事实上就是加上 <code>content-disposition: form-data; name=&quot;field1&quot;; filename=&quot;field&quot;</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/** Returns a new request body that transmits the content of &#123;<span class="doctag">@code</span> file&#125;. */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RequestBody <span class="title">create</span><span class="params">(<span class="keyword">final</span> @Nullable MediaType contentType, <span class="keyword">final</span> File file)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (file == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"file == null"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> RequestBody() &#123;</span><br><span class="line">    <span class="meta">@Override</span> <span class="keyword">public</span> <span class="meta">@Nullable</span> <span class="function">MediaType <span class="title">contentType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> contentType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">contentLength</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> file.length();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeTo</span><span class="params">(BufferedSink sink)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      Source source = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        source = Okio.source(file);</span><br><span class="line">        sink.writeAll(source);</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        Util.closeQuietly(source);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Part <span class="title">createFormData</span><span class="params">(String name, @Nullable String filename, RequestBody body)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (name == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"name == null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    StringBuilder disposition = <span class="keyword">new</span> StringBuilder(<span class="string">"form-data; name="</span>);</span><br><span class="line">    appendQuotedString(disposition, name);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (filename != <span class="keyword">null</span>) &#123;</span><br><span class="line">      disposition.append(<span class="string">"; filename="</span>);</span><br><span class="line">      appendQuotedString(disposition, filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> create(Headers.of(<span class="string">"Content-Disposition"</span>, disposition.toString()), body);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Part <span class="title">createFormData</span><span class="params">(String name, @Nullable String filename, RequestBody body)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (name == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"name == null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    StringBuilder disposition = <span class="keyword">new</span> StringBuilder(<span class="string">"form-data; name="</span>);</span><br><span class="line">    appendQuotedString(disposition, name);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (filename != <span class="keyword">null</span>) &#123;</span><br><span class="line">      disposition.append(<span class="string">"; filename="</span>);</span><br><span class="line">      appendQuotedString(disposition, filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> create(Headers.of(<span class="string">"Content-Disposition"</span>, disposition.toString()), body);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>可以看到  formdata 实际上就是将多个 RequestBody 封装成 Part 然后进行传输了。</p>
<p>一般来说，2.0会以下面的形式进行上传文件：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FileUploadService</span> </span>&#123;  </span><br><span class="line">    <span class="meta">@Multipart</span></span><br><span class="line">    <span class="meta">@POST</span>(<span class="string">"upload"</span>)</span><br><span class="line">    <span class="function">Call&lt;ResponseBody&gt; <span class="title">upload</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        @Part(<span class="string">"description"</span>)</span> RequestBody description,</span></span><br><span class="line"><span class="function">        @Part MultipartBody.Part file</span></span><br><span class="line"><span class="function">    )</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">## 服务端代码</span><br><span class="line"></span><br><span class="line">```js</span><br><span class="line">method: <span class="string">'POST'</span>,  </span><br><span class="line">path: <span class="string">'/upload'</span>,  </span><br><span class="line">config: &#123;  </span><br><span class="line">    payload: &#123;</span><br><span class="line">        maxBytes: <span class="number">209715200</span>,</span><br><span class="line">        output: <span class="string">'stream'</span>,</span><br><span class="line">        parse: <span class="keyword">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    handler: function(request, reply) &#123;</span><br><span class="line">        var multiparty = require(<span class="string">'multiparty'</span>);</span><br><span class="line">        var form = <span class="keyword">new</span> multiparty.Form();</span><br><span class="line">        form.parse(request.payload, function(err, fields, files) &#123;</span><br><span class="line">            console.log(err);</span><br><span class="line">            console.log(fields);</span><br><span class="line">            console.log(files);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> reply(util.inspect(&#123;fields: fields, files: files&#125;));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其将会打印日志：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">null  </span><br><span class="line">&#123; description: [ &apos;hello, this is description speaking&apos; ] &#125;</span><br><span class="line">&#123; picture:</span><br><span class="line">   [ &#123; fieldName: &apos;picture&apos;,</span><br><span class="line">       originalFilename: &apos;20160312_095248.jpg&apos;,</span><br><span class="line">       path: &apos;/var/folders/rq/q_m4_21j3lqf1lw48fqttx_80000gn/T/X_sxX6LDUMBcuUcUGDMBKc2T.jpg&apos;,</span><br><span class="line">       headers: [Object],</span><br><span class="line">       size: 39369 &#125; ] &#125;</span><br></pre></td></tr></table></figure>
<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">uploadFile</span><span class="params">(Uri fileUri)</span> </span>&#123;  </span><br><span class="line">    <span class="comment">// create upload service client</span></span><br><span class="line">    FileUploadService service =</span><br><span class="line">            ServiceGenerator.createService(FileUploadService.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// https://github.com/iPaulPro/aFileChooser/blob/master/aFileChooser/src/com/ipaulpro/afilechooser/utils/FileUtils.java</span></span><br><span class="line">    <span class="comment">// use the FileUtils to get the actual file by uri</span></span><br><span class="line">    File file = FileUtils.getFile(<span class="keyword">this</span>, fileUri);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create RequestBody instance from file</span></span><br><span class="line">    RequestBody requestFile =</span><br><span class="line">            RequestBody.create(</span><br><span class="line">                         MediaType.parse(getContentResolver().getType(fileUri)),</span><br><span class="line">                         file</span><br><span class="line">             );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MultipartBody.Part is used to send also the actual file name</span></span><br><span class="line">    MultipartBody.Part body =</span><br><span class="line">            MultipartBody.Part.createFormData(<span class="string">"picture"</span>, file.getName(), requestFile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// add another part within the multipart request</span></span><br><span class="line">    String descriptionString = <span class="string">"hello, this is description speaking"</span>;</span><br><span class="line">    RequestBody description =</span><br><span class="line">            RequestBody.create(</span><br><span class="line">                    okhttp3.MultipartBody.FORM, descriptionString);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// finally, execute the request</span></span><br><span class="line">    Call&lt;ResponseBody&gt; call = service.upload(description, body);</span><br><span class="line">    call.enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call,</span></span></span><br><span class="line"><span class="function"><span class="params">                               Response&lt;ResponseBody&gt; response)</span> </span>&#123;</span><br><span class="line">            Log.v(<span class="string">"Upload"</span>, <span class="string">"success"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;ResponseBody&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line">            Log.e(<span class="string">"Upload error:"</span>, t.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="OkHttp-的-Source与Sink"><a href="#OkHttp-的-Source与Sink" class="headerlink" title="OkHttp 的 Source与Sink"></a>OkHttp 的 Source与Sink</h1><p>从 RequestBody 的建立代码中，我们看到，实际上是将我们的 File 构造了一个 Source ， 然后写到了一个 Sink 中。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Okio</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Source <span class="title">source</span><span class="params">(File file)</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (file == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"file == null"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> source((InputStream)(<span class="keyword">new</span> FileInputStream(file)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Sink <span class="title">sink</span><span class="params">(File file)</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (file == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"file == null"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> sink((OutputStream)(<span class="keyword">new</span> FileOutputStream(file)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>我们可以简单的将 Source, Sink 看成是输入流或者输入流。虽然其提供了一些很有用很方便有效率的方法，但这不影响我们的讨论。</p>
<p>我们来看一下 OkHttp 是怎么样发送请求的，在 CallServerInterceptor 中，最终发生网络请求，发送数据：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  RealInterceptorChain realChain = (RealInterceptorChain) chain;</span><br><span class="line">  HttpCodec httpCodec = realChain.httpStream();</span><br><span class="line">  StreamAllocation streamAllocation = realChain.streamAllocation();</span><br><span class="line">  RealConnection connection = (RealConnection) realChain.connection();</span><br><span class="line">  Request request = realChain.request();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">long</span> sentRequestMillis = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">  realChain.eventListener().requestHeadersStart(realChain.call());</span><br><span class="line">  httpCodec.writeRequestHeaders(request);</span><br><span class="line">  realChain.eventListener().requestHeadersEnd(realChain.call(), request);</span><br><span class="line"></span><br><span class="line">  Response.Builder responseBuilder = <span class="keyword">null</span>;</span><br><span class="line">  <span class="comment">// 如果 Post 方法，且含有一个 Body</span></span><br><span class="line">  <span class="keyword">if</span> (HttpMethod.permitsRequestBody(request.method()) &amp;&amp; request.body() != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">// If there's a "Expect: 100-continue" header on the request, wait for a "HTTP/1.1 100</span></span><br><span class="line">    <span class="comment">// Continue" response before transmitting the request body. If we don't get that, return</span></span><br><span class="line">    <span class="comment">// what we did get (such as a 4xx response) without ever transmitting the request body.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"100-continue"</span>.equalsIgnoreCase(request.header(<span class="string">"Expect"</span>))) &#123;</span><br><span class="line">      httpCodec.flushRequest();</span><br><span class="line">      realChain.eventListener().responseHeadersStart(realChain.call());</span><br><span class="line">      responseBuilder = httpCodec.readResponseHeaders(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (responseBuilder == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="comment">// Write the request body if the "Expect: 100-continue" expectation was met.</span></span><br><span class="line">      realChain.eventListener().requestBodyStart(realChain.call());</span><br><span class="line">      <span class="keyword">long</span> contentLength = request.body().contentLength();</span><br><span class="line">      CountingSink requestBodyOut =</span><br><span class="line">          <span class="keyword">new</span> CountingSink(httpCodec.createRequestBody(request, contentLength));</span><br><span class="line">      BufferedSink bufferedRequestBody = Okio.buffer(requestBodyOut);</span><br><span class="line"></span><br><span class="line">      request.body().writeTo(bufferedRequestBody);</span><br><span class="line">      bufferedRequestBody.close();</span><br><span class="line">      realChain.eventListener()</span><br><span class="line">          .requestBodyEnd(realChain.call(), requestBodyOut.successfulCount);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!connection.isMultiplexed()) &#123;</span><br><span class="line">      <span class="comment">// If the "Expect: 100-continue" expectation wasn't met, prevent the HTTP/1 connection</span></span><br><span class="line">      <span class="comment">// from being reused. Otherwise we're still obligated to transmit the request body to</span></span><br><span class="line">      <span class="comment">// leave the connection in a consistent state.</span></span><br><span class="line">      streamAllocation.noNewStreams();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  httpCodec.finishRequest();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (responseBuilder == <span class="keyword">null</span>) &#123;</span><br><span class="line">    realChain.eventListener().responseHeadersStart(realChain.call());</span><br><span class="line">    responseBuilder = httpCodec.readResponseHeaders(<span class="keyword">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Response response = responseBuilder</span><br><span class="line">      .request(request)</span><br><span class="line">      .handshake(streamAllocation.connection().handshake())</span><br><span class="line">      .sentRequestAtMillis(sentRequestMillis)</span><br><span class="line">      .receivedResponseAtMillis(System.currentTimeMillis())</span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> code = response.code();</span><br><span class="line">  <span class="keyword">if</span> (code == <span class="number">100</span>) &#123;</span><br><span class="line">    <span class="comment">// server sent a 100-continue even though we did not request one.</span></span><br><span class="line">    <span class="comment">// try again to read the actual response</span></span><br><span class="line">    responseBuilder = httpCodec.readResponseHeaders(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">    response = responseBuilder</span><br><span class="line">            .request(request)</span><br><span class="line">            .handshake(streamAllocation.connection().handshake())</span><br><span class="line">            .sentRequestAtMillis(sentRequestMillis)</span><br><span class="line">            .receivedResponseAtMillis(System.currentTimeMillis())</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    code = response.code();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  realChain.eventListener()</span><br><span class="line">          .responseHeadersEnd(realChain.call(), response);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (forWebSocket &amp;&amp; code == <span class="number">101</span>) &#123;</span><br><span class="line">    <span class="comment">// Connection is upgrading, but we need to ensure interceptors see a non-null response body.</span></span><br><span class="line">    response = response.newBuilder()</span><br><span class="line">        .body(Util.EMPTY_RESPONSE)</span><br><span class="line">        .build();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    response = response.newBuilder()</span><br><span class="line">        .body(httpCodec.openResponseBody(response))</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">"close"</span>.equalsIgnoreCase(response.request().header(<span class="string">"Connection"</span>))</span><br><span class="line">      || <span class="string">"close"</span>.equalsIgnoreCase(response.header(<span class="string">"Connection"</span>))) &#123;</span><br><span class="line">    streamAllocation.noNewStreams();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ((code == <span class="number">204</span> || code == <span class="number">205</span>) &amp;&amp; response.body().contentLength() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ProtocolException(</span><br><span class="line">        <span class="string">"HTTP "</span> + code + <span class="string">" had non-zero Content-Length: "</span> + response.body().contentLength());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> response;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于代码在于：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">long</span> contentLength = request.body().contentLength();</span><br><span class="line">        CountingSink requestBodyOut =</span><br><span class="line">            <span class="keyword">new</span> CountingSink(httpCodec.createRequestBody(request, contentLength));</span><br><span class="line">        BufferedSink bufferedRequestBody = Okio.buffer(requestBodyOut);</span><br><span class="line"></span><br><span class="line">        request.body().writeTo(bufferedRequestBody);</span><br><span class="line">        bufferedRequestBody.close();</span><br></pre></td></tr></table></figure>
<p>此段代码将我们的 RequestBody 写到一个与连接相关联的 Sink 上，发送数据。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// RealConnection.java</span></span><br><span class="line">      sink = Okio.buffer(Okio.sink(rawSocket));</span><br></pre></td></tr></table></figure>
<p>这个 sink 会在 Http1Code 构建 CountingSink 的时候用到，实际上数据就是写到这里面的。</p>
<p>对于构建的 BufferedSink，其是以 8192 字节每次写入套接字：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// RealBufferedSink.java</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">writeAll</span><span class="params">(Source source)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (source == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"source == null"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">long</span> totalBytesRead = <span class="number">0L</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">long</span> readCount;</span><br><span class="line">            <span class="keyword">while</span>((readCount = source.read(<span class="keyword">this</span>.buffer, <span class="number">8192L</span>)) != -<span class="number">1L</span>) &#123;</span><br><span class="line">                totalBytesRead += readCount;</span><br><span class="line">                <span class="keyword">this</span>.emitCompleteSegments();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> totalBytesRead;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="对于上传文件进度回调的思路"><a href="#对于上传文件进度回调的思路" class="headerlink" title="对于上传文件进度回调的思路"></a>对于上传文件进度回调的思路</h1><p>看了一下谷歌，很多都是在我们将 RequestBody 读出并写到 sink 的时候进行回调：</p>
<p>比如这个地方：<a href="https://github.com/square/okhttp/blob/master/samples/guide/src/main/java/okhttp3/recipes/Progress.java" target="_blank" rel="noopener">okhttp recipes</a> 有类似的思路</p>
<p>上面这个是针对下载的。</p>
<p>而这个就是针对上传来显示进度的：<a href="https://medium.com/@PaulinaSadowska/display-progress-of-multipart-request-with-retrofit-and-rxjava-23a4a779e6ba" target="_blank" rel="noopener">OkHttp 上传显示进度</a></p>
</div><div class="post-copyright"><blockquote><p>原文作者: Gowa2017 Zhang</p><p>原文链接: <a href="https://gowa2017.github.io/RxJava/使用Retrofit-Rxjava来上传下载文件.html">https://gowa2017.github.io/RxJava/使用Retrofit-Rxjava来上传下载文件.html</a></p><p>版权声明: 转载请注明出处(必须保留作者署名及链接)</p></blockquote></div><div class="tags"><a href="/tags/RxJava/">RxJava</a></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/RxJava/关于RxJava操作符flatMap与concatMap的探究.html" class="pre">关于RxJava操作符flatMap与concatMap的探究</a><a href="/Windows/关于Windows的内核对象.html" class="next">关于Windows的内核对象</a></div><div id="comments"><div id="disqus_thread"></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HTTP"><span class="toc-text">HTTP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#术语"><span class="toc-text">术语</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#URI"><span class="toc-text">URI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URL"><span class="toc-text">URL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URN"><span class="toc-text">URN</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#消息格式"><span class="toc-text">消息格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#multipart-form-data"><span class="toc-text">multipart/form-data</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Retrofit-实现上传"><span class="toc-text">Retrofit 实现上传</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#完整代码"><span class="toc-text">完整代码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#OkHttp-的-Source与Sink"><span class="toc-text">OkHttp 的 Source与Sink</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#对于上传文件进度回调的思路"><span class="toc-text">对于上传文件进度回调的思路</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/Linux-Unix/在安卓中进行共享库的注入.html">在安卓中进行共享库的注入</a></li><li class="post-list-item"><a class="post-list-link" href="/Asm/Windows反调试技术.html">Windows反调试技术</a></li><li class="post-list-item"><a class="post-list-link" href="/Asm/Windows反虚拟机技术.html">Windows反虚拟机技术</a></li><li class="post-list-item"><a class="post-list-link" href="/Oracle/使用Sqlplus动态执行SQL命令.html">使用Sqlplus动态执行SQL命令</a></li><li class="post-list-item"><a class="post-list-link" href="/Asm/关于汇编中的PTR操作符.html">关于汇编中的PTR操作符</a></li><li class="post-list-item"><a class="post-list-link" href="/Asm/汇编中关于对于Pointer的一个描述.html">汇编中关于对于Pointer的一个描述</a></li><li class="post-list-item"><a class="post-list-link" href="/Asm/CheatEngine入门指南.html">CheatEngine入门指南</a></li><li class="post-list-item"><a class="post-list-link" href="/Lua/在macOS-Mojave上编译Lua失败的经历.html">在macOS-Mojave上编译Lua失败的经历</a></li><li class="post-list-item"><a class="post-list-link" href="/Lua/PIL.30.编写C函数的.html">PIL.30.编写C函数的</a></li><li class="post-list-item"><a class="post-list-link" href="/PIL/PIL.32.Lua中的资源管理.html">PIL.32.Lua中的资源管理</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Asm/">Asm</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Cocos-Creator/">Cocos Creator</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Cocos2d-X/">Cocos2d-X</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Cpp/">Cpp</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Device/">Device</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/GTD/">GTD</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Golang/">Golang</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">41</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kindle/">Kindle</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Unix/">Linux/Unix</a><span class="category-list-count">35</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Lua/">Lua</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Misc/">Misc</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Office/">Office</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Oracle/">Oracle</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PIL/">PIL</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RxJava/">RxJava</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SED-AWK/">SED&AWK</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Shell/">Shell</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TensorFlow/">TensorFlow</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Vim/">Vim</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Work/">Work</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/macOS/">macOS</a><span class="category-list-count">8</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/curl/" style="font-size: 15px;">curl</a> <a href="/tags/brew/" style="font-size: 15px;">brew</a> <a href="/tags/装修/" style="font-size: 15px;">装修</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/弯头/" style="font-size: 15px;">弯头</a> <a href="/tags/管件/" style="font-size: 15px;">管件</a> <a href="/tags/水管/" style="font-size: 15px;">水管</a> <a href="/tags/Word/" style="font-size: 15px;">Word</a> <a href="/tags/Office/" style="font-size: 15px;">Office</a> <a href="/tags/sed/" style="font-size: 15px;">sed</a> <a href="/tags/Golang/" style="font-size: 15px;">Golang</a> <a href="/tags/编程/" style="font-size: 15px;">编程</a> <a href="/tags/Cocos2d-X/" style="font-size: 15px;">Cocos2d-X</a> <a href="/tags/Lua/" style="font-size: 15px;">Lua</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/LVM/" style="font-size: 15px;">LVM</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/android-studio/" style="font-size: 15px;">android studio</a> <a href="/tags/svn/" style="font-size: 15px;">svn</a> <a href="/tags/RxJava/" style="font-size: 15px;">RxJava</a> <a href="/tags/android/" style="font-size: 15px;">android</a> <a href="/tags/word/" style="font-size: 15px;">word</a> <a href="/tags/REST/" style="font-size: 15px;">REST</a> <a href="/tags/Maven/" style="font-size: 15px;">Maven</a> <a href="/tags/VNC/" style="font-size: 15px;">VNC</a> <a href="/tags/Docx/" style="font-size: 15px;">Docx</a> <a href="/tags/X5/" style="font-size: 15px;">X5</a> <a href="/tags/Tbs/" style="font-size: 15px;">Tbs</a> <a href="/tags/SSH/" style="font-size: 15px;">SSH</a> <a href="/tags/Cocos-Creator/" style="font-size: 15px;">Cocos Creator</a> <a href="/tags/Cocos-Js/" style="font-size: 15px;">Cocos-Js</a> <a href="/tags/Cocos-Creator/" style="font-size: 15px;">Cocos-Creator</a> <a href="/tags/TensorFlow/" style="font-size: 15px;">TensorFlow</a> <a href="/tags/机器学习/" style="font-size: 15px;">机器学习</a> <a href="/tags/ML/" style="font-size: 15px;">ML</a> <a href="/tags/杂项/" style="font-size: 15px;">杂项</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/macOS/" style="font-size: 15px;">macOS</a> <a href="/tags/Oracle/" style="font-size: 15px;">Oracle</a> <a href="/tags/Sqlplus/" style="font-size: 15px;">Sqlplus</a> <a href="/tags/Application/" style="font-size: 15px;">Application</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/apache/" style="font-size: 15px;">apache</a> <a href="/tags/Network/" style="font-size: 15px;">Network</a> <a href="/tags/PAC/" style="font-size: 15px;">PAC</a> <a href="/tags/NFS/" style="font-size: 15px;">NFS</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/SVN/" style="font-size: 15px;">SVN</a> <a href="/tags/SQL/" style="font-size: 15px;">SQL</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Promise/" style="font-size: 15px;">Promise</a> <a href="/tags/Dagger/" style="font-size: 15px;">Dagger</a> <a href="/tags/Pomelo/" style="font-size: 15px;">Pomelo</a> <a href="/tags/Gradle/" style="font-size: 15px;">Gradle</a> <a href="/tags/Retrofit/" style="font-size: 15px;">Retrofit</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/AppExecutors/" style="font-size: 15px;">AppExecutors</a> <a href="/tags/JSON/" style="font-size: 15px;">JSON</a> <a href="/tags/Gson/" style="font-size: 15px;">Gson</a> <a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/Bash/" style="font-size: 15px;">Bash</a> <a href="/tags/Selector/" style="font-size: 15px;">Selector</a> <a href="/tags/GTD/" style="font-size: 15px;">GTD</a> <a href="/tags/AAR/" style="font-size: 15px;">AAR</a> <a href="/tags/Room/" style="font-size: 15px;">Room</a> <a href="/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/tags/MFC/" style="font-size: 15px;">MFC</a> <a href="/tags/Cpp/" style="font-size: 15px;">Cpp</a> <a href="/tags/Work/" style="font-size: 15px;">Work</a> <a href="/tags/AAA/" style="font-size: 15px;">AAA</a> <a href="/tags/Vim/" style="font-size: 15px;">Vim</a> <a href="/tags/加固/" style="font-size: 15px;">加固</a> <a href="/tags/RegEx/" style="font-size: 15px;">RegEx</a> <a href="/tags/正则表达式/" style="font-size: 15px;">正则表达式</a> <a href="/tags/POSIX/" style="font-size: 15px;">POSIX</a> <a href="/tags/Kindle/" style="font-size: 15px;">Kindle</a> <a href="/tags/小说/" style="font-size: 15px;">小说</a> <a href="/tags/F5/" style="font-size: 15px;">F5</a> <a href="/tags/负载均衡/" style="font-size: 15px;">负载均衡</a> <a href="/tags/awk/" style="font-size: 15px;">awk</a> <a href="/tags/iptables/" style="font-size: 15px;">iptables</a> <a href="/tags/越狱/" style="font-size: 15px;">越狱</a> <a href="/tags/阅读/" style="font-size: 15px;">阅读</a> <a href="/tags/Cron/" style="font-size: 15px;">Cron</a> <a href="/tags/Go/" style="font-size: 15px;">Go</a> <a href="/tags/Unix/" style="font-size: 15px;">Unix</a> <a href="/tags/网络/" style="font-size: 15px;">网络</a> <a href="/tags/OSPF/" style="font-size: 15px;">OSPF</a> <a href="/tags/数据库/" style="font-size: 15px;">数据库</a> <a href="/tags/Oralce/" style="font-size: 15px;">Oralce</a> <a href="/tags/视图/" style="font-size: 15px;">视图</a> <a href="/tags/OpenSSH/" style="font-size: 15px;">OpenSSH</a> <a href="/tags/OpenSSL/" style="font-size: 15px;">OpenSSL</a> <a href="/tags/ntpd/" style="font-size: 15px;">ntpd</a> <a href="/tags/tcpdump/" style="font-size: 15px;">tcpdump</a> <a href="/tags/抓包/" style="font-size: 15px;">抓包</a> <a href="/tags/Github/" style="font-size: 15px;">Github</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">Gowa2017 Zhang.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-137245514-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="/js/search.json.js?v=2.0.3"></script><<<<<<< Updated upstream<script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
});</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML" async></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.3" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script><script>var disqus_shortname = 'gowa-1';
var disqus_identifier = 'RxJava/使用Retrofit-Rxjava来上传下载文件.html';
var disqus_title = '使用Retrofit-Rxjava来上传下载文件';
var disqus_url = 'https://gowa2017.github.io/RxJava/使用Retrofit-Rxjava来上传下载文件.html';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//gowa-1.disqus.com/count.js" async></script><script type="text/javascript" src="//gowa-1.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></body></html>