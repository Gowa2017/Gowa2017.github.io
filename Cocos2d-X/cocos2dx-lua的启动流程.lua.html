<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Cocos2d-X-lua的启动流程.lua | 退思园</title><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.3"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.3"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css?v=2.0.3"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js?v=2.0.3"></script><script src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=2.0.3"></script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Cocos2d-X-lua的启动流程.lua</h1><a id="logo" href="/.">退思园</a><p class="description">烦恼一般都是想太多了。</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/soft"><i class="fa fa-rss"> soft</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Cocos2d-X-lua的启动流程.lua</h1><div class="post-meta"><a href="/Cocos2d-X/cocos2dx-lua的启动流程.lua.html#comments" class="comment-count"><i data-disqus-identifier="Cocos2d-X/cocos2dx-lua的启动流程.lua.html" class="disqus-comment-count"></i>留言</a><p><span class="date">Feb 23, 2018</span><span><a href="/categories/Cocos2d-X/" class="category">Cocos2d-X</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>可能以前用的项目就是Lua，所以比较喜欢Lua。服务端也用skynet框架，都用Lua，能统一的话是最好的了。完全是个人爱好。但是有必要看一下，我对客户端是最不熟的了，图形这一块。</p>
<h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><p>新建一个Lua项目后:</p>
<pre><code>cocos new -l lua -p com.example.me -d game
</code></pre><p>进入目录：</p>
<pre><code>cd game/MyLuaGame/frameworks/rutime-src/Classes
</code></pre><p><strong>AppDelegate.cpp</strong>是我们需要关注的文件。他干了一系列的事情：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">bool</span> AppDelegate::applicationDidFinishLaunching()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// set default FPS</span></span><br><span class="line">    Director::getInstance()-&gt;setAnimationInterval(<span class="number">1.0</span> / <span class="number">60.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// register lua module</span></span><br><span class="line">    <span class="comment">// 注册 lua 模块</span></span><br><span class="line">    <span class="keyword">auto</span> engine = LuaEngine::getInstance();</span><br><span class="line">    ScriptEngineManager::getInstance()-&gt;setScriptEngine(engine);</span><br><span class="line">    lua_State* L = engine-&gt;getLuaStack()-&gt;getLuaState();</span><br><span class="line">    lua_module_register(L);</span><br><span class="line"></span><br><span class="line">    register_all_packages();</span><br><span class="line"></span><br><span class="line">    LuaStack* <span class="built_in">stack</span> = engine-&gt;getLuaStack();</span><br><span class="line">    <span class="built_in">stack</span>-&gt;setXXTEAKeyAndSign(<span class="string">"2dxLua"</span>, <span class="built_in">strlen</span>(<span class="string">"2dxLua"</span>), <span class="string">"XXTEA"</span>, <span class="built_in">strlen</span>(<span class="string">"XXTEA"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//register custom function</span></span><br><span class="line">    <span class="comment">//LuaStack* stack = engine-&gt;getLuaStack();</span></span><br><span class="line">    <span class="comment">//register_custom_function(stack-&gt;getLuaState());</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 添加的这两个路径，我们其实都不用手动在项目内添加了</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> CC_64BITS</span></span><br><span class="line">    FileUtils::getInstance()-&gt;addSearchPath(<span class="string">"src/64bit"</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    FileUtils::getInstance()-&gt;addSearchPath(<span class="string">"src"</span>);</span><br><span class="line">    FileUtils::getInstance()-&gt;addSearchPath(<span class="string">"res"</span>);</span><br><span class="line">    <span class="keyword">if</span> (engine-&gt;executeScriptFile(<span class="string">"main.lua"</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个类其实就干了两个事情：</p>
<ul>
<li>开个Lua State 把模块都注册进去</li>
<li>引擎执行 <strong>main.lua</strong></li>
</ul>
<p>另外，其实以前那种写法:</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">cc.FileUtils:getInstance():addSearchPath(<span class="string">"src/"</span>)</span><br><span class="line">cc.FileUtils:getInstance():addSearchPath(<span class="string">"res/"</span>)</span><br></pre></td></tr></table></figure>
<p>这样的代码已经不需要了。程序已经自动注册了这两个路径了。程序会自动在这两个地方寻找资源。</p>
<h1 id="模块及函数的注册到State"><a href="#模块及函数的注册到State" class="headerlink" title="模块及函数的注册到State"></a>模块及函数的注册到State</h1><h2 id="lua-module-register-L"><a href="#lua-module-register-L" class="headerlink" title="lua_module_register(L);"></a>lua_module_register(L);</h2><p>这玩意会在我们的Lua State内注册一系列的模块。我们取个例子来看一下，比如第一个模块。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// frameworks/cocos2d-x/cocos/scripting/lua-bindings/manual/lua_module_register.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lua_module_register</span><span class="params">(lua_State* L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Don't change the module register order unless you know what your are doing</span></span><br><span class="line">    register_cocosdenshion_module(L);</span><br><span class="line">    register_network_module(L);</span><br><span class="line">    register_cocosbuilder_module(L);</span><br><span class="line">    register_cocostudio_module(L);</span><br><span class="line">    register_ui_module(L);</span><br><span class="line">    register_extension_module(L);</span><br><span class="line">    register_spine_module(L);</span><br><span class="line">    register_cocos3d_module(L);</span><br><span class="line">    register_audioengine_module(L);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> CC_USE_3D_PHYSICS &amp;&amp; CC_ENABLE_BULLET_INTEGRATION</span></span><br><span class="line">    register_physics3d_module(L);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> CC_USE_NAVMESH</span></span><br><span class="line">    register_navmesh_module(L);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="register-cocosdenshion-module"><a href="#register-cocosdenshion-module" class="headerlink" title="register_cocosdenshion_module"></a>register_cocosdenshion_module</h2><p>这个函数干的活比较简单，就是获取一下Lua的全局环境，然后把所有的模块内容注册进去。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//scripting/lua-bindings/manual/cocosdenshion/lua_cocos2dx_cocosdenshion_manual.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>  <span class="title">register_cocosdenshion_module</span><span class="params">(lua_State* L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    lua_getglobal(L, <span class="string">"_G"</span>);</span><br><span class="line">    <span class="keyword">if</span> (lua_istable(L,<span class="number">-1</span>))<span class="comment">//stack:...,_G,</span></span><br><span class="line">    &#123;</span><br><span class="line">        register_all_cocos2dx_cocosdenshion(L);</span><br><span class="line">    &#125;</span><br><span class="line">    lua_pop(L, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>真正干活的，还是下面一个函数。</p>
<h2 id="register-all-cocos2dx-cocosdenshion"><a href="#register-all-cocos2dx-cocosdenshion" class="headerlink" title="register_all_cocos2dx_cocosdenshion"></a>register_all_cocos2dx_cocosdenshion</h2><p>tolua 没有用过，但是一下他们的代码就知道了。很明显，是用了<code>open, module, beginmodule, endmodule</code>来干活的。<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">TOLUA_API <span class="keyword">int</span> <span class="title">register_all_cocos2dx_cocosdenshion</span><span class="params">(lua_State* tolua_S)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        tolua_open(tolua_S);</span><br><span class="line"></span><br><span class="line">        tolua_module(tolua_S,<span class="string">"cc"</span>,<span class="number">0</span>);</span><br><span class="line">        tolua_beginmodule(tolua_S,<span class="string">"cc"</span>);</span><br><span class="line"></span><br><span class="line">        lua_register_cocos2dx_cocosdenshion_SimpleAudioEngine(tolua_S);</span><br><span class="line"></span><br><span class="line">        tolua_endmodule(tolua_S);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="小插曲"><a href="#小插曲" class="headerlink" title="小插曲"></a>小插曲</h3><p>我们先来看一下，Lua关于注册表的概念。</p>
<blockquote>
<p>Lua提供了应该注册表，这个表可以被任何C代码用来存储任何的Lua值。注册表总是位于伪索引 <strong>LUA_REISTRYINDEX</strong>上（并不在Lua State的真正的栈上）。任何C库都可以使用这个表来存储数据，但必须谨慎选择键，以避免出现冲突。典型滴，用一包含你库名的字符串作为键，或者是一个light userdata（C对象的指针），或者任何被自己代码创建的Lua对象。和变量名字一样，以一个下划线后跟大写字母的字符串是保留的。</p>
<p>整型的键用来做索引算法（<strong>luaL_ref</strong>）和一些预定义的值。因此，整型键不应该用作其他目录。</p>
<p>当建一个新的Lua State时，这个注册您就有一些预定义的值。这些预定义的值以<strong>lua.h</strong>定义的常量整数作为键，下面的两个是定义好的：</p>
<p><strong>LUA_RIDX_MAINTHREAD</strong> 注册内保存的State的主线程（与State一起建立的那个线程）<br><strong>LUA_RIDX_GLOBALS</strong> 注册表内的这个索引保存了全局环境。</p>
</blockquote>
<p>我们可以假设这个注册表刚开始的时候是这样的：</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">t_reg = &#123;  [LUA_RIDX_MAINTHREAD] = value,</span><br><span class="line">			 [LUA_RIDX_GLOBALS] = <span class="built_in">_G</span>,</span><br><span class="line">			 &#125;</span><br></pre></td></tr></table></figure>
<h3 id="lua-settable-lua-rawset"><a href="#lua-settable-lua-rawset" class="headerlink" title="lua_settable lua_rawset"></a>lua_settable lua_rawset</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">luasettable(L, index)</span><br><span class="line">luarawset(L, index)</span><br></pre></td></tr></table></figure>
<p>这两个函数和代码 <code>t[k] = v</code>是一样的，<em>t</em> 就是位于 <em>index</em> 处的值，<em>v</em> 是栈的顶部的值， <em>k</em> 是在栈顶部下的值。</p>
<p>这两个函数会将 键 和 值都弹出。</p>
<p>不同的是，<code>luarawset</code> 并不会触发事件 <strong>__newindex</strong> 的元方法。</p>
<h3 id="lua-gettable-lua-rawget"><a href="#lua-gettable-lua-rawget" class="headerlink" title="lua_gettable lua_rawget"></a>lua_gettable lua_rawget</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">lua_gettable(L, index)</span><br><span class="line">lua_rawget(L, index)</span><br></pre></td></tr></table></figure>
<p>把 <em>t[k]</em>的值压入栈，<em>t</em> 是 <em>index</em> 指定的值，<em>k</em> 是栈顶部的值。</p>
<p>这两个函数都会把键弹出，然后把结果值压入那个位置。<code>lua_rawget</code>不会触发 <strong>__index</strong> 事件的元方法。</p>
<p>返回值是是结果值的类型。</p>
<h2 id="tolua"><a href="#tolua" class="headerlink" title="tolua"></a>tolua</h2><h3 id="tolua-open"><a href="#tolua-open" class="headerlink" title="tolua_open"></a>tolua_open</h3><p>首先调用的是 <code>tolua_open</code> 函数：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// frameworks/cocos2d-x/external/lua/tolua/tolua_map.c</span></span><br><span class="line"></span><br><span class="line"><span class="function">TOLUA_API <span class="keyword">void</span> <span class="title">tolua_open</span> <span class="params">(lua_State* L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> top = lua_gettop(L);</span><br><span class="line">    <span class="comment">// 检查 tolua 是否打开。用 t["tolua_opened"] = true | false 来判断</span></span><br><span class="line">    lua_pushstring(L,<span class="string">"tolua_opened"</span>);</span><br><span class="line">    lua_rawget(L,LUA_REGISTRYINDEX);</span><br><span class="line">    <span class="keyword">if</span> (!lua_isboolean(L,<span class="number">-1</span>))</span><br><span class="line">    &#123;</span><br><span class="line">    	<span class="comment">// 如果没打开就打开它</span></span><br><span class="line">    	<span class="comment">// t_reg["tolua_opened"] = 1</span></span><br><span class="line">        lua_pushstring(L,<span class="string">"tolua_opened"</span>);</span><br><span class="line">        lua_pushboolean(L,<span class="number">1</span>);</span><br><span class="line">        lua_rawset(L,LUA_REGISTRYINDEX);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// create value root table</span></span><br><span class="line">        <span class="comment">// 建立根表</span></span><br><span class="line">        <span class="comment">// t_reg["tolua_value_root"] = &#123;&#125;</span></span><br><span class="line">        lua_pushstring(L, TOLUA_VALUE_ROOT);</span><br><span class="line">        lua_newtable(L);</span><br><span class="line">        lua_rawset(L, LUA_REGISTRYINDEX);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> LUA_VERSION_NUM <span class="comment">/* only prior to lua 5.1 */</span></span></span><br><span class="line">        <span class="comment">/* create peer object table */</span></span><br><span class="line">        lua_pushstring(L, <span class="string">"tolua_peers"</span>);</span><br><span class="line">        lua_newtable(L);</span><br><span class="line">        <span class="comment">/* make weak key metatable for peers indexed by userdata object */</span></span><br><span class="line">        lua_newtable(L);</span><br><span class="line">        lua_pushliteral(L, <span class="string">"__mode"</span>);</span><br><span class="line">        lua_pushliteral(L, <span class="string">"k"</span>);</span><br><span class="line">        lua_rawset(L, <span class="number">-3</span>);                <span class="comment">/* stack: string peers mt */</span></span><br><span class="line">        lua_setmetatable(L, <span class="number">-2</span>);   <span class="comment">/* stack: string peers */</span></span><br><span class="line">        lua_rawset(L,LUA_REGISTRYINDEX);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* create object ptr -&gt; udata mapping table */</span></span><br><span class="line">        lua_pushstring(L,<span class="string">"tolua_ubox"</span>);</span><br><span class="line">        lua_newtable(L);</span><br><span class="line">        <span class="comment">/* make weak value metatable for ubox table to allow userdata to be</span></span><br><span class="line"><span class="comment">           garbage-collected */</span></span><br><span class="line">        lua_newtable(L);</span><br><span class="line">        lua_pushliteral(L, <span class="string">"__mode"</span>);</span><br><span class="line">        lua_pushliteral(L, <span class="string">"v"</span>);</span><br><span class="line">        lua_rawset(L, <span class="number">-3</span>);               <span class="comment">/* stack: string ubox mt */</span></span><br><span class="line">        lua_setmetatable(L, <span class="number">-2</span>);  <span class="comment">/* stack: string ubox */</span></span><br><span class="line">        lua_rawset(L,LUA_REGISTRYINDEX);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        /* create object ptr -&gt; class type mapping table */</span></span><br><span class="line"><span class="comment">//        lua_pushstring(L, "tolua_ptr2type");</span></span><br><span class="line"><span class="comment">//        lua_newtable(L);</span></span><br><span class="line"><span class="comment">//        lua_rawset(L, LUA_REGISTRYINDEX);</span></span><br><span class="line"></span><br><span class="line">        lua_pushstring(L,<span class="string">"tolua_super"</span>);</span><br><span class="line">        lua_newtable(L);</span><br><span class="line">        lua_rawset(L,LUA_REGISTRYINDEX);</span><br><span class="line">        lua_pushstring(L,<span class="string">"tolua_gc"</span>);</span><br><span class="line">        lua_newtable(L);</span><br><span class="line">        lua_rawset(L,LUA_REGISTRYINDEX);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* create gc_event closure */</span></span><br><span class="line">        lua_pushstring(L, <span class="string">"tolua_gc_event"</span>);</span><br><span class="line">        lua_pushstring(L, <span class="string">"tolua_gc"</span>);</span><br><span class="line">        lua_rawget(L, LUA_REGISTRYINDEX);</span><br><span class="line">        lua_pushstring(L, <span class="string">"tolua_super"</span>);</span><br><span class="line">        lua_rawget(L, LUA_REGISTRYINDEX);</span><br><span class="line">        lua_pushcclosure(L, class_gc_event, <span class="number">2</span>);</span><br><span class="line">        lua_rawset(L, LUA_REGISTRYINDEX);</span><br><span class="line"></span><br><span class="line">        tolua_newmetatable(L,<span class="string">"tolua_commonclass"</span>);</span><br><span class="line"></span><br><span class="line">        tolua_module(L,<span class="literal">NULL</span>,<span class="number">0</span>);</span><br><span class="line">        tolua_beginmodule(L,<span class="literal">NULL</span>);</span><br><span class="line">        tolua_module(L,<span class="string">"tolua"</span>,<span class="number">0</span>);</span><br><span class="line">        tolua_beginmodule(L,<span class="string">"tolua"</span>);</span><br><span class="line">        tolua_function(L,<span class="string">"type"</span>,tolua_bnd_type);</span><br><span class="line">        tolua_function(L,<span class="string">"takeownership"</span>,tolua_bnd_takeownership);</span><br><span class="line">        tolua_function(L,<span class="string">"releaseownership"</span>,tolua_bnd_releaseownership);</span><br><span class="line">        tolua_function(L,<span class="string">"cast"</span>,tolua_bnd_cast);</span><br><span class="line">        tolua_function(L,<span class="string">"isnull"</span>,tolua_bnd_isnulluserdata);</span><br><span class="line">        tolua_function(L,<span class="string">"inherit"</span>, tolua_bnd_inherit);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> LUA_VERSION_NUM <span class="comment">/* lua 5.1 */</span></span></span><br><span class="line">        tolua_function(L, <span class="string">"setpeer"</span>, tolua_bnd_setpeer);</span><br><span class="line">        tolua_function(L, <span class="string">"getpeer"</span>, tolua_bnd_getpeer);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">        tolua_function(L,<span class="string">"getcfunction"</span>, tolua_bnd_getcfunction);</span><br><span class="line">        tolua_function(L,<span class="string">"iskindof"</span>, tolua_bnd_iskindof);</span><br><span class="line"></span><br><span class="line">        tolua_endmodule(L);</span><br><span class="line">        tolua_endmodule(L);</span><br><span class="line">    &#125;</span><br><span class="line">    lua_settop(L,top);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这些都不用多说了，反正就是在 注册表内，添加两很多元素。</p>
<h3 id="tolua-module"><a href="#tolua-module" class="headerlink" title="tolua_module"></a>tolua_module</h3><p>这个函数会创建一个模块。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// frameworks/cocos2d-x/external/lua/tolua/tolua_map.c</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">TOLUA_API <span class="keyword">void</span> <span class="title">tolua_module</span> <span class="params">(lua_State* L, <span class="keyword">const</span> <span class="keyword">char</span>* name, <span class="keyword">int</span> hasvar)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (name)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* tolua module */</span></span><br><span class="line">        lua_pushstring(L,name);</span><br><span class="line">        lua_rawget(L,<span class="number">-2</span>);</span><br><span class="line">        <span class="keyword">if</span> (!lua_istable(L,<span class="number">-1</span>))  <span class="comment">/* check if module already exists */</span></span><br><span class="line">        &#123;</span><br><span class="line">            lua_pop(L,<span class="number">1</span>);</span><br><span class="line">            lua_newtable(L);</span><br><span class="line">            lua_pushstring(L,name);</span><br><span class="line">            lua_pushvalue(L,<span class="number">-2</span>);</span><br><span class="line">            lua_rawset(L,<span class="number">-4</span>);       <span class="comment">/* assing module into module */</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* global table */</span></span><br><span class="line">        lua_pushvalue(L,LUA_GLOBALSINDEX);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (hasvar)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!tolua_ismodulemetatable(L))  <span class="comment">/* check if it already has a module metatable */</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/* create metatable to get/set C/C++ variable */</span></span><br><span class="line">            lua_newtable(L);</span><br><span class="line">            tolua_moduleevents(L);</span><br><span class="line">            <span class="keyword">if</span> (lua_getmetatable(L,<span class="number">-2</span>))</span><br><span class="line">                lua_setmetatable(L,<span class="number">-2</span>);  <span class="comment">/* set old metatable as metatable of metatable */</span></span><br><span class="line">            lua_setmetatable(L,<span class="number">-2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    lua_pop(L,<span class="number">1</span>);               <span class="comment">/* pop module */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个函数么，就是在注册表内，建立一个新模块。<em>havar</em> 表示是不是这个模块有元表。</p>
<h2 id="注册完成"><a href="#注册完成" class="headerlink" title="注册完成"></a>注册完成</h2><p>在执行了函数 <code>register_all_cocos2dx_cocosdenshion</code>后，我们的注册表可能看起来是这样的：</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">t_reg = &#123;</span><br><span class="line">...  <span class="comment">-- 预定义的值</span></span><br><span class="line">[<span class="string">"cc"</span>] = &#123;</span><br><span class="line">			[<span class="string">"getInstance"</span>] = lua_cocos2dx_cocosdenshion_SimpleAudioEngi, <span class="comment">-- 这就是导出来给我们在Lua中用的</span></span><br><span class="line">			.....</span><br><span class="line">			&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="main-lua的执行"><a href="#main-lua的执行" class="headerlink" title="main.lua的执行"></a>main.lua的执行</h1><p><code>engine-&gt;executeScriptFile(&quot;main.lua&quot;)</code>就开始执行 <em>main.lua</em>了。</p>
<p>之后，其实就跟普通的Lua脚本执行没有什么差别了，通过在State中调用C函数，来操作整个引擎了。</p>
<p>而对于，导出的函数，继续以 Lua 进行封装后以模块的方式调用，其实也没有什么特别的。</p>
<p>这就是 C -&gt; Lua State -&gt; lua script -&gt; Cfunction -&gt; Cobj 流程类似了。</p>
<p>不信你看一下，项目中 src 目录下的 cocos中。全是这样干的。</p>
<p>在我们所有的项目中，都有：</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span> <span class="string">"config"</span></span><br><span class="line"><span class="built_in">require</span> <span class="string">"cocos.init"</span></span><br></pre></td></tr></table></figure>
<p>其实就是加载我们的配置文件，然后再加载 cocos Lua封装的初始化文件。打开 <em>cocos/init.lua</em> 就可以看到，其一一个个个 require 语句，用来加载封装成Lua的各个模块。</p>
<p>我们关注有一句：</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- src/cocos/init.lua</span></span><br><span class="line"><span class="keyword">if</span> CC_USE_FRAMEWORK <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">require</span> <span class="string">"cocos.framework.init"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>其实这一段，是用了更高层的封装，更加方便使用，其实应该就是 Quick 干的事情。</p>
<p>如果我们在我们的 <em>config.lua</em> 中定义了这个变量，那么，就可以使用那些封装了。</p>
</div><div class="post-copyright"><blockquote><p>原文作者: Gowa2017 Zhang</p><p>原文链接: <a href="https://gowa2017.github.io/Cocos2d-X/cocos2dx-lua的启动流程.lua.html">https://gowa2017.github.io/Cocos2d-X/cocos2dx-lua的启动流程.lua.html</a></p><p>版权声明: 转载请注明出处(必须保留作者署名及链接)</p></blockquote></div><div class="tags"><a href="/tags/Cocos2d-X/">Cocos2d-X</a></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/Cocos2d-X/cocos2dx-lua中关于类的实现及使用.html" class="pre">Cocos2d-X-lua中关于类的实现及使用</a><a href="/Lua/PIL.16Lua的编译、执行和错误.html" class="next">PIL.16Lua的编译、执行</a></div><div id="comments"><div id="disqus_thread"></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#启动"><span class="toc-text">启动</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#模块及函数的注册到State"><span class="toc-text">模块及函数的注册到State</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#lua-module-register-L"><span class="toc-text">lua_module_register(L);</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#register-cocosdenshion-module"><span class="toc-text">register_cocosdenshion_module</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#register-all-cocos2dx-cocosdenshion"><span class="toc-text">register_all_cocos2dx_cocosdenshion</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#小插曲"><span class="toc-text">小插曲</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lua-settable-lua-rawset"><span class="toc-text">lua_settable lua_rawset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lua-gettable-lua-rawget"><span class="toc-text">lua_gettable lua_rawget</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tolua"><span class="toc-text">tolua</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#tolua-open"><span class="toc-text">tolua_open</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tolua-module"><span class="toc-text">tolua_module</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注册完成"><span class="toc-text">注册完成</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#main-lua的执行"><span class="toc-text">main.lua的执行</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/Java/关于SprintMVC配置文件的加载及初始化.html">关于SprintMVC配置文件的加载及初始化</a></li><li class="post-list-item"><a class="post-list-link" href="/Android/Retrofit下载文件及ResponseBody解析.html">Retrofit下载文件及ResponseBody解析</a></li><li class="post-list-item"><a class="post-list-link" href="/Linux/RealVNC的VNC-Viewer连接到VM虚拟机出错的问题.html">RealVNC的VNC-Viewer连接到VM虚拟机出错的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/RxJava/RxJava的blocking操作符.html">RxJava的blocking操作符</a></li><li class="post-list-item"><a class="post-list-link" href="/RxJava/RxJava使用Schedulers时进行的线程切换.html">RxJava使用Schedulers时进行的线程切换</a></li><li class="post-list-item"><a class="post-list-link" href="/RxJava/RxJava的聚合操作函数collect与groupby.html">RxJava的聚合操作函数collect与groupby</a></li><li class="post-list-item"><a class="post-list-link" href="/RxJava/RxJava使用blockingGet造成麻烦问题.html">RxJava使用blockingGet造成麻烦问题</a></li><li class="post-list-item"><a class="post-list-link" href="/RxJava/关于RxJava操作符链式调用的理解.html">关于RxJava操作符链式调用的理解</a></li><li class="post-list-item"><a class="post-list-link" href="/Android/关于在Module中添加aar包无效的问题.html">关于在Module中添加aar包无效的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/Android/使用Room进行持久化.html">使用Room进行持久化</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AIX/">AIX</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Cocos-Creator/">Cocos Creator</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Cocos2d-X/">Cocos2d-X</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Device/">Device</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/GTD/">GTD</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Golang/">Golang</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">38</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kindle/">Kindle</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Lua/">Lua</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Novel/">Novel</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Office/">Office</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Oracle/">Oracle</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RxJava/">RxJava</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SED-AWK/">SED&AWK</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Shell/">Shell</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TensorFlow/">TensorFlow</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Vim/">Vim</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Work/">Work</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/macOS/">macOS</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂项/">杂项</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程/">编程</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/IPSec/" style="font-size: 15px;">IPSec</a> <a href="/tags/curl/" style="font-size: 15px;">curl</a> <a href="/tags/装修/" style="font-size: 15px;">装修</a> <a href="/tags/brew/" style="font-size: 15px;">brew</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Word/" style="font-size: 15px;">Word</a> <a href="/tags/Office/" style="font-size: 15px;">Office</a> <a href="/tags/弯头/" style="font-size: 15px;">弯头</a> <a href="/tags/管件/" style="font-size: 15px;">管件</a> <a href="/tags/水管/" style="font-size: 15px;">水管</a> <a href="/tags/sed/" style="font-size: 15px;">sed</a> <a href="/tags/Golang/" style="font-size: 15px;">Golang</a> <a href="/tags/编程/" style="font-size: 15px;">编程</a> <a href="/tags/Lua/" style="font-size: 15px;">Lua</a> <a href="/tags/Cocos2d-X/" style="font-size: 15px;">Cocos2d-X</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/LVM/" style="font-size: 15px;">LVM</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/android-studio/" style="font-size: 15px;">android studio</a> <a href="/tags/svn/" style="font-size: 15px;">svn</a> <a href="/tags/android/" style="font-size: 15px;">android</a> <a href="/tags/word/" style="font-size: 15px;">word</a> <a href="/tags/REST/" style="font-size: 15px;">REST</a> <a href="/tags/Maven/" style="font-size: 15px;">Maven</a> <a href="/tags/VNC/" style="font-size: 15px;">VNC</a> <a href="/tags/Docx/" style="font-size: 15px;">Docx</a> <a href="/tags/SSH/" style="font-size: 15px;">SSH</a> <a href="/tags/X5/" style="font-size: 15px;">X5</a> <a href="/tags/Tbs/" style="font-size: 15px;">Tbs</a> <a href="/tags/Cocos-Creator/" style="font-size: 15px;">Cocos Creator</a> <a href="/tags/Cocos-Js/" style="font-size: 15px;">Cocos-Js</a> <a href="/tags/Cocos-Creator/" style="font-size: 15px;">Cocos-Creator</a> <a href="/tags/TensorFlow/" style="font-size: 15px;">TensorFlow</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/机器学习/" style="font-size: 15px;">机器学习</a> <a href="/tags/ML/" style="font-size: 15px;">ML</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/杂项/" style="font-size: 15px;">杂项</a> <a href="/tags/Oracle/" style="font-size: 15px;">Oracle</a> <a href="/tags/macOS/" style="font-size: 15px;">macOS</a> <a href="/tags/Sqlplus/" style="font-size: 15px;">Sqlplus</a> <a href="/tags/Application/" style="font-size: 15px;">Application</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/apache/" style="font-size: 15px;">apache</a> <a href="/tags/Dagger/" style="font-size: 15px;">Dagger</a> <a href="/tags/Network/" style="font-size: 15px;">Network</a> <a href="/tags/PAC/" style="font-size: 15px;">PAC</a> <a href="/tags/SQL/" style="font-size: 15px;">SQL</a> <a href="/tags/NFS/" style="font-size: 15px;">NFS</a> <a href="/tags/SVN/" style="font-size: 15px;">SVN</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Promise/" style="font-size: 15px;">Promise</a> <a href="/tags/Pomelo/" style="font-size: 15px;">Pomelo</a> <a href="/tags/Retrofit/" style="font-size: 15px;">Retrofit</a> <a href="/tags/The-Java-Tutorial/" style="font-size: 15px;">The Java Tutorial</a> <a href="/tags/Closure/" style="font-size: 15px;">Closure</a> <a href="/tags/skynet/" style="font-size: 15px;">skynet</a> <a href="/tags/epoll/" style="font-size: 15px;">epoll</a> <a href="/tags/select/" style="font-size: 15px;">select</a> <a href="/tags/poll/" style="font-size: 15px;">poll</a> <a href="/tags/rsync/" style="font-size: 15px;">rsync</a> <a href="/tags/Gradle/" style="font-size: 15px;">Gradle</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/GTD/" style="font-size: 15px;">GTD</a> <a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/Bash/" style="font-size: 15px;">Bash</a> <a href="/tags/Selector/" style="font-size: 15px;">Selector</a> <a href="/tags/CPU/" style="font-size: 15px;">CPU</a> <a href="/tags/8086/" style="font-size: 15px;">8086</a> <a href="/tags/内存管理/" style="font-size: 15px;">内存管理</a> <a href="/tags/Work/" style="font-size: 15px;">Work</a> <a href="/tags/AAA/" style="font-size: 15px;">AAA</a> <a href="/tags/AIX/" style="font-size: 15px;">AIX</a> <a href="/tags/Vim/" style="font-size: 15px;">Vim</a> <a href="/tags/加固/" style="font-size: 15px;">加固</a> <a href="/tags/RegEx/" style="font-size: 15px;">RegEx</a> <a href="/tags/正则表达式/" style="font-size: 15px;">正则表达式</a> <a href="/tags/POSIX/" style="font-size: 15px;">POSIX</a> <a href="/tags/Kindle/" style="font-size: 15px;">Kindle</a> <a href="/tags/小说/" style="font-size: 15px;">小说</a> <a href="/tags/F5/" style="font-size: 15px;">F5</a> <a href="/tags/负载均衡/" style="font-size: 15px;">负载均衡</a> <a href="/tags/FTP/" style="font-size: 15px;">FTP</a> <a href="/tags/awk/" style="font-size: 15px;">awk</a> <a href="/tags/iptables/" style="font-size: 15px;">iptables</a> <a href="/tags/越狱/" style="font-size: 15px;">越狱</a> <a href="/tags/阅读/" style="font-size: 15px;">阅读</a> <a href="/tags/Cron/" style="font-size: 15px;">Cron</a> <a href="/tags/Unix/" style="font-size: 15px;">Unix</a> <a href="/tags/Go/" style="font-size: 15px;">Go</a> <a href="/tags/网络/" style="font-size: 15px;">网络</a> <a href="/tags/OSPF/" style="font-size: 15px;">OSPF</a> <a href="/tags/OpenSSH/" style="font-size: 15px;">OpenSSH</a> <a href="/tags/OpenSSL/" style="font-size: 15px;">OpenSSL</a> <a href="/tags/数据库/" style="font-size: 15px;">数据库</a> <a href="/tags/Oralce/" style="font-size: 15px;">Oralce</a> <a href="/tags/视图/" style="font-size: 15px;">视图</a> <a href="/tags/Device/" style="font-size: 15px;">Device</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">Gowa2017 Zhang.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-137245514-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="/js/search.json.js?v=2.0.3"></script><<<<<<< Updated upstream<script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
});</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML" async></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.3" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script><script>var disqus_shortname = 'gowa-1';
var disqus_identifier = 'Cocos2d-X/cocos2dx-lua的启动流程.lua.html';
var disqus_title = 'Cocos2d-X-lua的启动流程.lua';
var disqus_url = 'https://gowa2017.github.io/Cocos2d-X/cocos2dx-lua的启动流程.lua.html';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//gowa-1.disqus.com/count.js" async></script><script type="text/javascript" src="//gowa-1.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></body></html>